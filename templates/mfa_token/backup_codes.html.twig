{% extends 'admin/layout.html.twig' %}

{% block admin_title %}{{ 'mfa_token.backup_codes.title'|trans({}, 'mfa') }}{% endblock %}
{% block admin_subtitle %}
    <p class="text-muted">{{ 'mfa_token.backup_codes.subtitle'|trans({}, 'mfa') }}</p>
{% endblock %}

{% block admin_content %}
    <div class="mb-4">
        <a href="{{ path('admin_mfa_show', {id: mfa_token.id}) }}" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left" aria-hidden="true"></i> {{ 'common.back'|trans({}, 'messages') }}
        </a>
    </div>

    <div class="row">
        <div class="col-lg-8 offset-lg-2">
            <div class="alert alert-danger">
                <h4 class="alert-heading">
                    <i class="bi bi-shield-exclamation" aria-hidden="true"></i> {{ 'mfa_token.backup_codes.warning'|trans({}, 'mfa') }}
                </h4>
                <p>{{ 'mfa_token.backup_codes.warning_text'|trans({}, 'mfa') }}</p>
                <hr>
                <p class="mb-0">
                    <strong>{{ 'mfa_token.backup_codes.onetime_display'|trans({}, 'mfa') }}</strong>
                </p>
            </div>

            <div class="card border-warning mb-4"
                 data-controller="backup-codes"
                 data-backup-codes-codes-value="{{ backup_codes|json_encode }}"
                 data-backup-codes-user-email-value="{{ mfa_token.user.email }}"
                 data-backup-codes-device-name-value="{{ mfa_token.deviceName }}"
                 data-backup-codes-title-text-value="{{ 'mfa_token.backup_codes.title'|trans({}, 'mfa') }}"
                 data-backup-codes-user-label-value="{{ 'mfa_token.field.user'|trans({}, 'mfa') }}"
                 data-backup-codes-device-label-value="{{ 'mfa_token.field.device_name'|trans({}, 'mfa') }}"
                 data-backup-codes-generated-label-value="{{ 'common.generated'|trans({}, 'messages') }}"
                 data-backup-codes-warning-title-value="{{ 'mfa_token.backup_codes.warning'|trans({}, 'mfa') }}"
                 data-backup-codes-warning-text-value="{{ 'mfa_token.backup_codes.warning_text'|trans({}, 'mfa') }}"
                 data-backup-codes-codes-label-value="{{ 'mfa_token.backup_codes.codes'|trans({}, 'mfa') }}"
                 data-backup-codes-usage-title-value="{{ 'mfa_token.backup_codes.usage_title'|trans({}, 'mfa') }}"
                 data-backup-codes-usage1-value="{{ 'mfa_token.backup_codes.usage_1'|trans({}, 'mfa') }}"
                 data-backup-codes-usage2-value="{{ 'mfa_token.backup_codes.usage_2'|trans({}, 'mfa') }}"
                 data-backup-codes-usage3-value="{{ 'mfa_token.backup_codes.usage_3'|trans({}, 'mfa') }}"
                 data-backup-codes-usage4-value="{{ 'mfa_token.backup_codes.usage_4'|trans({}, 'mfa') }}"
                 data-backup-codes-copied-text-value="{{ 'common.copied'|trans({}, 'messages') }}"
                 data-backup-codes-downloaded-text-value="{{ 'common.downloaded'|trans({}, 'messages') }}"
                 data-backup-codes-copy-failed-text-value="{{ 'common.copy_failed'|trans({}, 'messages') }}">
                <div class="card-header bg-warning">
                    <div class="d-flex justify-content-between align-items-center">
                        <h3 class="mb-0">{{ 'mfa_token.backup_codes.codes'|trans({}, 'mfa') }}</h3>
                        <span class="badge bg-dark">{{ backup_codes|length }} {{ 'mfa_token.backup_codes.codes_count'|trans({}, 'mfa') }}</span>
                    </div>
                </div>
                <div class="card-body">
                    <div class="alert alert-info">
                        <strong><i class="bi bi-person" aria-hidden="true"></i> {{ 'mfa_token.field.user'|trans({}, 'mfa') }}:</strong> {{ mfa_token.user.email }}<br>
                        <strong><i class="bi bi-phone" aria-hidden="true"></i> {{ 'mfa_token.field.device_name'|trans({}, 'mfa') }}:</strong> {{ mfa_token.deviceName }}<br>
                        <strong><i class="bi bi-calendar" aria-hidden="true"></i> {{ 'common.generated'|trans({}, 'messages') }}:</strong> {{ 'now'|date('Y-m-d H:i:s') }}
                    </div>

                    <div class="row">
                        {% for code in backup_codes %}
                            <div class="col-md-6 mb-2">
                                <div class="bg-light p-3 rounded border">
                                    <span class="badge bg-secondary me-2">{{ loop.index }}</span>
                                    <span class="font-monospace fw-bold">{{ code }}</span>
                                </div>
                            </div>
                        {% endfor %}
                    </div>

                    <div class="d-grid gap-2 mt-4">
                        <button type="button"
                                class="btn btn-primary"
                                data-action="backup-codes#copy">
                            <i class="bi bi-clipboard" aria-hidden="true"></i> {{ 'mfa_token.backup_codes.copy_all'|trans({}, 'mfa') }}
                        </button>
                        <button type="button"
                                class="btn btn-outline-secondary"
                                data-action="backup-codes#print">
                            <i class="bi bi-printer" aria-hidden="true"></i> {{ 'mfa_token.backup_codes.print'|trans({}, 'mfa') }}
                        </button>
                        <button type="button"
                                class="btn btn-outline-secondary"
                                data-action="backup-codes#download">
                            <i class="bi bi-download" aria-hidden="true"></i> {{ 'mfa_token.backup_codes.download'|trans({}, 'mfa') }}
                        </button>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-body">
                    <h5><i class="bi bi-info-circle" aria-hidden="true"></i> {{ 'mfa_token.backup_codes.usage_title'|trans({}, 'mfa') }}</h5>
                    <ul>
                        <li>{{ 'mfa_token.backup_codes.usage_1'|trans({}, 'mfa') }}</li>
                        <li>{{ 'mfa_token.backup_codes.usage_2'|trans({}, 'mfa') }}</li>
                        <li>{{ 'mfa_token.backup_codes.usage_3'|trans({}, 'mfa') }}</li>
                        <li>{{ 'mfa_token.backup_codes.usage_4'|trans({}, 'mfa') }}</li>
                    </ul>

                    <div class="alert alert-warning">
                        <i class="bi bi-exclamation-triangle" aria-hidden="true"></i>
                        {{ 'mfa_token.backup_codes.regenerate_warning'|trans({}, 'mfa') }}
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
