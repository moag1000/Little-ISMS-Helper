{% extends 'base.html.twig' %}
{% trans_default_domain 'locations' %}

{% block title %}{{ location.name }} - {{ 'location.title.show'|trans({}, 'locations') }} - Little ISMS Helper{% endblock %}

{% block body %}
<div class="container">
    {% include '_components/_breadcrumb.html.twig' with {
        breadcrumbs: [
            { label: 'nav.locations'|trans({}, 'nav'), url: path('app_location_index') },
            { label: location.name }
        ]
    } %}
</div>

<div class="page-header">
    <div>
        <h1>{{ location.name }}</h1>
        <div class="mt-2">
            {% include '_components/_badge.html.twig' with { variant: 'info', content: ('location.type.' ~ location.locationType)|trans({}, 'locations') } %}
            {% if location.code %}
                <code class="ml-sm">{{ location.code }}</code>
            {% endif %}
        </div>
    </div>
    <div class="button-group">
        <a href="{{ path('app_location_edit', {id: location.id}) }}" class="btn btn-primary">
            <i class="bi bi-pencil" aria-hidden="true"></i> {{ 'common.edit'|trans({}, 'messages') }}
        </a>
        <a href="{{ path('app_location_index') }}" class="btn btn-secondary">
            ‚Üê {{ 'common.back_to_list'|trans({}, 'messages') }}
        </a>
    </div>
</div>

{# Location Details #}
{% embed '_components/_card.html.twig' with {class: 'mb-4'} %}
    {% block card_body %}
    <h2>{{ 'location.section.details'|trans({}, 'locations') }}</h2>

    {% if location.description %}
    <div class="form-group mt-3">
        <label class="form-label">{{ 'location.field.description'|trans({}, 'locations') }}</label>
        <p class="text-light-pre-wrap">{{ location.description }}</p>
    </div>
    {% endif %}

    <div class="stats-grid mt-3 grid-responsive-250">
        <div class="stat-item">
            <strong>{{ ('location.type.' ~ location.locationType)|trans({}, 'locations') }}</strong>
            <span>{{ 'location.field.type'|trans({}, 'locations') }}</span>
        </div>

        {% if location.parentLocation %}
        <div class="stat-item">
            <strong>
                <a href="{{ path('app_location_show', {id: location.parentLocation.id}) }}">
                    {{ location.parentLocation.name }}
                </a>
            </strong>
            <span>{{ 'location.field.parent_location'|trans({}, 'locations') }}</span>
        </div>
        {% endif %}

        <div class="stat-item">
            <strong>
                {% set securityColors = {
                    'public': 'secondary',
                    'restricted': 'info',
                    'controlled': 'warning',
                    'secure': 'warning',
                    'high_security': 'danger'
                } %}
                <span class="badge bg-{{ securityColors[location.securityLevel] ?? 'secondary' }}">
                    {{ ('location.security.' ~ location.securityLevel)|trans({}, 'locations') }}
                </span>
            </strong>
            <span>{{ 'location.field.security_level'|trans({}, 'locations') }}</span>
        </div>

        <div class="stat-item">
            <strong>
                {% if location.requiresBadgeAccess %}
                    {% include '_components/_badge.html.twig' with { variant: 'success', content: 'common.yes'|trans({}, 'messages') } %}
                {% else %}
                    {% include '_components/_badge.html.twig' with { variant: 'secondary', content: 'common.no'|trans({}, 'messages') } %}
                {% endif %}
            </strong>
            <span>{{ 'location.field.badge_access'|trans({}, 'locations') }}</span>
        </div>
    </div>
    {% endblock %}
{% endembed %}

{# Address Information #}
{% if location.address or location.city or location.country %}
{% embed '_components/_card.html.twig' with {class: 'mb-4'} %}
    {% block card_body %}
    <h2>{{ 'location.section.address'|trans({}, 'locations') }}</h2>
    <div class="info-box mt-2 bg-light">
        {% if location.address %}
            <p>{{ location.address }}</p>
        {% endif %}
        {% if location.postalCode or location.city %}
            <p>
                {% if location.postalCode %}{{ location.postalCode }}{% endif %}
                {{ location.city }}
            </p>
        {% endif %}
        {% if location.country %}
            <p><strong>{{ location.country }}</strong></p>
        {% endif %}
    </div>
    {% endblock %}
{% endembed %}
{% endif %}

{# Child Locations #}
{% if location.childLocations|length > 0 %}
{% embed '_components/_card.html.twig' with {class: 'mb-4'} %}
    {% block card_body %}
    <h2>{{ 'location.section.child_locations'|trans({}, 'locations') }} ({{ location.childLocations|length }})</h2>
    <div class="mt-2">
    {% embed '_components/_table.html.twig' with {
        'noMargin': true,
        'responsive': true
    } %}
        {% block table_head %}
            <tr>
                <th scope="col">{{ 'location.field.name'|trans({}, 'locations') }}</th>
                <th scope="col">{{ 'location.field.type'|trans({}, 'locations') }}</th>
                <th scope="col">{{ 'location.field.security_level'|trans({}, 'locations') }}</th>
                <th scope="col" class="text-center">{{ 'common.actions'|trans({}, 'messages') }}</th>
            </tr>
        {% endblock %}
        {% block table_body %}
            {% for child in location.childLocations %}
            <tr>
                <td>{{ child.name }}</td>
                <td>{% include '_components/_badge.html.twig' with { variant: 'info', content: ('location.type.' ~ child.locationType)|trans({}, 'locations') } %}</td>
                <td>
                    {% set securityColors = {
                        'public': 'secondary',
                        'restricted': 'info',
                        'controlled': 'warning',
                        'secure': 'warning',
                        'high_security': 'danger'
                    } %}
                    <span class="badge bg-{{ securityColors[child.securityLevel] ?? 'secondary' }}">
                        {{ ('location.security.' ~ child.securityLevel)|trans({}, 'locations') }}
                    </span>
                </td>
                <td class="text-center">
                    <a href="{{ path('app_location_show', {id: child.id}) }}" class="btn btn-sm">
                        üëÅ {{ 'common.view'|trans({}, 'messages') }}
                    </a>
                </td>
            </tr>
            {% endfor %}
        {% endblock %}
    {% endembed %}
    </div>
    {% endblock %}
{% endembed %}
{% endif %}

{# Additional Features #}
{% embed '_components/_card.html.twig' %}
    {% block card_body %}
    <h2>{{ 'location.section.features'|trans({}, 'locations') }}</h2>
    <div class="stats-grid mt-2 grid-responsive-250">
        <div class="stat-item">
            <strong>
                {% if location.active %}
                    {% include '_components/_badge.html.twig' with { variant: 'success', content: 'common.active'|trans({}, 'messages') } %}
                {% else %}
                    {% include '_components/_badge.html.twig' with { variant: 'secondary', content: 'common.inactive'|trans({}, 'messages') } %}
                {% endif %}
            </strong>
            <span>{{ 'location.field.status'|trans({}, 'locations') }}</span>
        </div>

        <div class="stat-item">
            <strong>
                {% if location.accessControlSystem %}
                    {% include '_components/_badge.html.twig' with { variant: 'info', content: location.accessControlSystem } %}
                {% else %}
                    <span class="text-muted-color">-</span>
                {% endif %}
            </strong>
            <span>{{ 'location.field.access_control'|trans({}, 'locations') }}</span>
        </div>
    </div>
    {% endblock %}
{% endembed %}

{# Action Buttons #}
<div class="button-group mt-xl">
    <a href="{{ path('app_location_edit', {id: location.id}) }}" class="btn btn-primary">
        <i class="bi bi-pencil" aria-hidden="true"></i> {{ 'common.edit'|trans({}, 'messages') }}
    </a>
    <a href="{{ path('app_location_index') }}" class="btn btn-secondary">
        <i class="bi bi-list" aria-hidden="true"></i> {{ 'common.back_to_list'|trans({}, 'messages') }}
    </a>
    <form method="post" action="{{ path('app_location_delete', {id: location.id}) }}" class="d-inline"
          data-controller="ui-actions"
          data-action="submit->ui-actions#confirm"
          data-ui-actions-message-param="{{ 'location.confirm.delete'|trans({}, 'locations') }}">
        <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ location.id) }}">
        <button type="submit" class="btn btn-danger"><i class="bi bi-trash" aria-hidden="true"></i> {{ 'common.delete'|trans({}, 'messages') }}</button>
    </form>
</div>
{% endblock %}
