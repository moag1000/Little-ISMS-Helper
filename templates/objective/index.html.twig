{% extends 'base.html.twig' %}
{% trans_default_domain 'objective'%}
{% import '_macros/cards.html.twig' as cards %}

{% block title %}{{ 'objective.page.title'|trans({}, 'objective') }} - {{ 'app.title'|trans({}, 'messages') }}{% endblock %}

{% block body %}
<div class="container-fluid py-4">
    {% include '_components/_breadcrumb.html.twig' with {
        breadcrumbs: [
            { label: 'nav.objectives'|trans({}, 'nav') }
        ]
    } %}

    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h2"><i class="bi bi-target" aria-hidden="true"></i> {{ 'objective.page.title'|trans({}, 'objective') }}</h1>
        {% if is_granted('ROLE_ADMIN') %}
        <a href="{{ path('app_objective_new') }}" class="btn btn-primary"><i class="bi bi-plus-circle" aria-hidden="true"></i> {{ 'objective.action.add_new'|trans({}, 'objective') }}</a>
        {% endif %}
    </div>

    <turbo-frame id="objective-stats">
        <div class="row mb-4">
            <div class="col-md-3">
                {{ cards.kpi_card(('objective.stats.total'|trans({}, 'objective')), statistics.total, null, null, 'primary', 'border-primary') }}
            </div>
            <div class="col-md-3">
                {{ cards.kpi_card(('objective.stats.active'|trans({}, 'objective')), statistics.active, null, null, 'info', 'border-info') }}
            </div>
            <div class="col-md-3">
                {{ cards.kpi_card(('objective.stats.achieved'|trans({}, 'objective')), statistics.achieved, null, null, 'success', 'border-success') }}
            </div>
            <div class="col-md-3">
                {{ cards.kpi_card(('objective.stats.delayed'|trans({}, 'objective')), statistics.delayed, null, null, 'warning', 'border-warning') }}
            </div>
        </div>
    </turbo-frame>

    <div class="card">
        <div class="card-header bg-primary text-white"><h2 class="mb-0">{{ 'objective.list.title'|trans({'%count%': objectives|length}, 'objective') }}</h2></div>
        <div class="card-body">
            {% if objectives|length == 0 %}
            <div class="alert alert-info">{{ 'objective.message.no_objectives'|trans({}, 'objective') }}</div>
            {% else %}
            {% embed '_components/_table.html.twig' with {
                'noMargin': true
            } %}
                {% block table_head %}
                    <tr>
                        <th scope="col">{{ 'objective.table.title'|trans({}, 'objective') }}</th>
                        <th scope="col">{{ 'objective.table.category'|trans({}, 'objective') }}</th>
                        <th scope="col">{{ 'objective.table.target_date'|trans({}, 'objective') }}</th>
                        <th scope="col">{{ 'objective.table.progress'|trans({}, 'objective') }}</th>
                        <th scope="col">{{ 'objective.table.status'|trans({}, 'objective') }}</th>
                        <th scope="col">{{ 'common.actions'|trans({}, 'messages') }}</th>
                    </tr>
                {% endblock %}
                {% block table_body %}
                    {% for objective in objectives %}
                    <tr>
                        <td><strong>{{ objective.title }}</strong></td>
                        <td><span class="badge bg-secondary">{{ objective.category }}</span></td>
                        <td>{{ objective.targetDate|date('d.m.Y') }}</td>
                        <td>
                            <div class="progress" style="height: 20px;">
                                <div class="progress-bar {% if objective.progressPercentage >= 75 %}bg-success{% elseif objective.progressPercentage >= 50 %}bg-warning{% else %}bg-danger{% endif %}"
                                     style="width: {{ objective.progressPercentage }}%">{{ objective.progressPercentage }}%</div>
                            </div>
                        </td>
                        <td><span class="badge bg-{{ objective.status == 'achieved' ? 'success' : (objective.status == 'in_progress' ? 'info' : 'warning') }}">{{ ('objective.status.' ~ objective.status)|trans({}, 'objective') }}</span></td>
                        <td>
                            <a href="{{ path('app_objective_show', {id: objective.id}) }}" class="btn btn-sm btn-outline-primary" aria-label="{{ 'common.view'|trans({}, 'messages') }}" title="{{ 'common.view'|trans({}, 'messages') }}"><i class="bi bi-eye" aria-hidden="true"></i></a>
                            {% if is_granted('ROLE_ADMIN') %}
                            <a href="{{ path('app_objective_edit', {id: objective.id}) }}" class="btn btn-sm btn-outline-secondary" aria-label="{{ 'common.edit'|trans({}, 'messages') }}" title="{{ 'common.edit'|trans({}, 'messages') }}"><i class="bi bi-pencil" aria-hidden="true"></i></a>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                {% endblock %}
            {% endembed %}
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
