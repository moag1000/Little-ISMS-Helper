<!DOCTYPE html>
<html lang="{{ app.request.locale }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ config.name }} - Compliance Report</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 11pt;
            line-height: 1.5;
            color: #333;
            padding: 20px 40px;
        }
        .header {
            border-bottom: 3px solid #0d6efd;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }
        .header h1 {
            font-size: 24pt;
            color: #0d6efd;
            margin-bottom: 5px;
        }
        .header .subtitle {
            color: #666;
            font-size: 12pt;
        }
        .meta-info {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 30px;
            border-radius: 5px;
        }
        .meta-info table {
            width: 100%;
        }
        .meta-info td {
            padding: 5px 10px;
        }
        .meta-info .label {
            font-weight: bold;
            color: #666;
            width: 150px;
        }
        .score-box {
            text-align: center;
            padding: 30px;
            margin: 30px 0;
            border-radius: 10px;
        }
        .score-box.compliant { background: #d1e7dd; border: 2px solid #198754; }
        .score-box.partial { background: #fff3cd; border: 2px solid #ffc107; }
        .score-box.in_progress { background: #cff4fc; border: 2px solid #0dcaf0; }
        .score-box.non_compliant { background: #f8d7da; border: 2px solid #dc3545; }
        .score-box .score {
            font-size: 48pt;
            font-weight: bold;
        }
        .score-box.compliant .score { color: #198754; }
        .score-box.partial .score { color: #856404; }
        .score-box.in_progress .score { color: #055160; }
        .score-box.non_compliant .score { color: #dc3545; }
        .score-box .status {
            font-size: 14pt;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        h2 {
            color: #0d6efd;
            font-size: 16pt;
            margin: 30px 0 15px 0;
            padding-bottom: 5px;
            border-bottom: 1px solid #dee2e6;
        }
        h3 {
            font-size: 12pt;
            margin: 20px 0 10px 0;
        }
        table.data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        table.data-table th,
        table.data-table td {
            border: 1px solid #dee2e6;
            padding: 8px 12px;
            text-align: left;
        }
        table.data-table th {
            background: #f8f9fa;
            font-weight: bold;
        }
        table.data-table tr:nth-child(even) {
            background: #f8f9fa;
        }
        .progress-bar {
            background: #e9ecef;
            border-radius: 4px;
            height: 10px;
            overflow: hidden;
        }
        .progress-bar .fill {
            height: 100%;
            border-radius: 4px;
        }
        .progress-bar .fill.success { background: #198754; }
        .progress-bar .fill.warning { background: #ffc107; }
        .progress-bar .fill.danger { background: #dc3545; }
        .badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 9pt;
            font-weight: bold;
        }
        .badge.success { background: #d1e7dd; color: #0f5132; }
        .badge.warning { background: #fff3cd; color: #856404; }
        .badge.danger { background: #f8d7da; color: #842029; }
        .gap-item {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 10px 15px;
            margin: 10px 0;
        }
        .gap-item.critical {
            background: #f8d7da;
            border-left-color: #dc3545;
        }
        .gap-item strong {
            display: block;
            margin-bottom: 5px;
        }
        .footer {
            margin-top: 50px;
            padding-top: 20px;
            border-top: 1px solid #dee2e6;
            font-size: 9pt;
            color: #666;
            text-align: center;
        }
        .page-break {
            page-break-before: always;
        }
        @media print {
            body { padding: 0; }
            .page-break { page-break-before: always; }
        }
    </style>
</head>
<body>
    {# Header #}
    <div class="header">
        <h1>{{ config.name }}</h1>
        <div class="subtitle">Compliance Assessment Report</div>
    </div>

    {# Meta Information #}
    <div class="meta-info">
        <table>
            <tr>
                <td class="label">Framework:</td>
                <td>{{ config.name }} ({{ config.code }})</td>
                <td class="label">Assessment Date:</td>
                <td>{{ generated_at|date('d.m.Y H:i') }}</td>
            </tr>
            <tr>
                <td class="label">Organization:</td>
                <td>{{ tenant ? tenant.name : 'N/A' }}</td>
                <td class="label">Categories Assessed:</td>
                <td>{{ result.categories|length }}</td>
            </tr>
        </table>
    </div>

    {# Overall Score #}
    <div class="score-box {{ result.status }}">
        <div class="score">{{ result.overall_score }}%</div>
        <div class="status">
            {% if result.status == 'compliant' %}Compliant
            {% elseif result.status == 'partial' %}Partially Compliant
            {% elseif result.status == 'in_progress' %}In Progress
            {% else %}Non-Compliant{% endif %}
        </div>
    </div>

    {# Executive Summary #}
    <h2>Executive Summary</h2>
    <p>
        This assessment evaluated {{ result.categories|length }} categories against the {{ config.name }} requirements.
        The overall compliance score is <strong>{{ result.overall_score }}%</strong>.
        {% if result.critical_gap_count > 0 %}
        <strong style="color: #dc3545;">{{ result.critical_gap_count }} critical gaps</strong> require immediate attention.
        {% else %}
        No critical gaps were identified.
        {% endif %}
    </p>

    {# Category Overview #}
    <h2>Category Results</h2>
    <table class="data-table">
        <thead>
            <tr>
                <th>Category</th>
                <th style="width: 100px;">Score</th>
                <th style="width: 150px;">Progress</th>
                <th style="width: 80px;">Gaps</th>
                <th style="width: 100px;">Status</th>
            </tr>
        </thead>
        <tbody>
            {% for key, category in result.categories %}
            <tr>
                <td><strong>{{ category.name|trans({}, 'wizard') }}</strong></td>
                <td>{{ category.score }}%</td>
                <td>
                    <div class="progress-bar">
                        <div class="fill {% if category.score >= 80 %}success{% elseif category.score >= 60 %}warning{% else %}danger{% endif %}"
                             style="width: {{ category.score }}%;"></div>
                    </div>
                </td>
                <td>{{ category.gap_count }}</td>
                <td>
                    <span class="badge {% if category.score >= 80 %}success{% elseif category.score >= 60 %}warning{% else %}danger{% endif %}">
                        {{ category.status|upper }}
                    </span>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    {# Critical Gaps #}
    {% if result.critical_gaps|length > 0 %}
    <div class="page-break"></div>
    <h2>Critical Gaps Requiring Immediate Action</h2>
    {% for gap in result.critical_gaps %}
    <div class="gap-item critical">
        <strong>{{ gap.title|trans({}, 'wizard') }}</strong>
        {% if gap.description is defined %}
        <p>{{ gap.description|trans({}, 'wizard') }}</p>
        {% endif %}
        {% if gap.action is defined %}
        <p><strong>Recommended Action:</strong> {{ gap.action|trans({}, 'wizard') }}</p>
        {% endif %}
        <span class="badge danger">Priority: {{ gap.priority|upper }}</span>
    </div>
    {% endfor %}
    {% endif %}

    {# Detailed Results #}
    <div class="page-break"></div>
    <h2>Detailed Category Results</h2>

    {% for key, category in result.categories %}
    <h3>{{ category.name|trans({}, 'wizard') }} - {{ category.score }}%</h3>

    <table class="data-table">
        <thead>
            <tr>
                <th>Check</th>
                <th style="width: 80px;">Score</th>
                <th style="width: 100px;">Status</th>
            </tr>
        </thead>
        <tbody>
            {% for item_key, item in category.items %}
            <tr>
                <td>
                    {{ item.name|trans({}, 'wizard') }}
                    {% if item.gap %}
                    <br><small style="color: #dc3545;">Gap: {{ item.gap.title|trans({}, 'wizard') }}</small>
                    {% endif %}
                </td>
                <td>{{ item.score }}%</td>
                <td>
                    <span class="badge {% if item.score >= 80 %}success{% elseif item.score >= 50 %}warning{% else %}danger{% endif %}">
                        {{ item.status|upper }}
                    </span>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    {% if category.gaps|length > 0 %}
    <p><strong>Gaps identified in this category:</strong></p>
    {% for gap in category.gaps %}
    <div class="gap-item {% if gap.priority == 'critical' %}critical{% endif %}">
        <strong>{{ gap.title|trans({}, 'wizard') }}</strong>
        {% if gap.description is defined %}
        <p>{{ gap.description|trans({}, 'wizard') }}</p>
        {% endif %}
    </div>
    {% endfor %}
    {% endif %}

    {% endfor %}

    {# Footer #}
    <div class="footer">
        <p>
            Generated by Little ISMS Helper | {{ generated_at|date('d.m.Y H:i') }}<br>
            This report is based on automated analysis of your ISMS data and should be reviewed by a qualified professional.
        </p>
    </div>
</body>
</html>
