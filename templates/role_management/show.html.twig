{% extends 'admin/layout.html.twig' %}
{% trans_default_domain 'role_management' %}

{% block title %}{{ role.name }} - {{ 'role_management.title.show'|trans({}, 'role_management') }} - Little ISMS Helper{% endblock %}

{% block admin_content %}
<div class="container">
    {% include '_components/_breadcrumb.html.twig' with {
        breadcrumbs: [
            { label: 'nav.admin'|trans({}, 'nav'), url: path('admin_dashboard') },
            { label: 'nav.roles'|trans({}, 'nav'), url: path('role_management_index') },
            { label: role.name }
        ]
    } %}
</div>

<div class="page-header">
    <div>
        <h1>{{ role.name }}</h1>
        <div class="mt-2">
            {% if role.systemRole %}
                {% include '_components/_badge.html.twig' with { variant: 'info', content: 'role_management.badge.system'|trans({}, 'role_management') } %}
            {% else %}
                {% include '_components/_badge.html.twig' with { variant: 'secondary', content: 'role_management.badge.custom'|trans({}, 'role_management') } %}
            {% endif %}
        </div>
    </div>
    <div class="button-group">
        <a href="{{ path('role_management_edit', {id: role.id}) }}" class="btn btn-primary">
            <i class="bi bi-pencil" aria-hidden="true"></i> {{ 'common.edit'|trans({}, 'messages') }}
        </a>
        <a href="{{ path('role_management_index') }}" class="btn btn-secondary">
            ‚Üê {{ 'common.back_to_list'|trans({}, 'messages') }}
        </a>
    </div>
</div>

{# Role Details #}
{% embed '_components/_card.html.twig' with { 'class': 'mb-4' } %}
    {% block card_body %}
        <h2>{{ 'role_management.section.details'|trans({}, 'role_management') }}</h2>

        <div class="stats-grid mt-3 grid-responsive-250">
            <div class="stat-item">
                <strong>{{ role.name }}</strong>
                <span>{{ 'role_management.field.name'|trans({}, 'role_management') }}</span>
            </div>

            <div class="stat-item">
                <strong>{{ role.users|length }}</strong>
                <span>{{ 'role_management.field.users'|trans({}, 'role_management') }}</span>
            </div>

            <div class="stat-item">
                <strong>{{ role.permissions|length }}</strong>
                <span>{{ 'role_management.field.permissions'|trans({}, 'role_management') }}</span>
            </div>
        </div>

        {% if role.description %}
        <div class="mt-3">
            <h2 class="h3-small">{{ 'role_management.field.description'|trans({}, 'role_management') }}</h2>
            <div class="info-box bg-light">
                <p class="pre-wrap">{{ role.description }}</p>
            </div>
        </div>
        {% endif %}
    {% endblock %}
{% endembed %}

{# Permissions #}
{% embed '_components/_card.html.twig' with { 'class': 'mb-4' } %}
    {% block card_body %}
        <h2>{{ 'role_management.section.permissions'|trans({}, 'role_management') }}</h2>

        {% if role.permissions|length > 0 %}
        <div class="table-container mt-3">
            {% embed '_components/_table.html.twig' with {'noMargin': true, 'responsive': true} %}
                {% block table_head %}
                    <tr>
                        <th scope="col">{{ 'role_management.permission.name'|trans({}, 'role_management') }}</th>
                        <th scope="col">{{ 'role_management.permission.resource'|trans({}, 'role_management') }}</th>
                        <th scope="col">{{ 'role_management.permission.action'|trans({}, 'role_management') }}</th>
                    </tr>
                {% endblock %}
                {% block table_body %}
                    {% for permission in role.permissions %}
                    <tr>
                        <td><strong>{{ permission.name }}</strong></td>
                        <td>{% include '_components/_badge.html.twig' with { variant: 'info', content: permission.resource } %}</td>
                        <td>{% include '_components/_badge.html.twig' with { variant: 'secondary', content: permission.action } %}</td>
                    </tr>
                    {% endfor %}
                {% endblock %}
            {% endembed %}
        </div>
        {% else %}
        <p class="text-muted-mt-sm">
            {{ 'role_management.message.no_permissions'|trans({}, 'role_management') }}
        </p>
        {% endif %}
    {% endblock %}
{% endembed %}

{# Assigned Users #}
{% embed '_components/_card.html.twig' with { 'class': 'mb-4' } %}
    {% block card_body %}
        <h2>{{ 'role_management.section.users'|trans({}, 'role_management') }}</h2>

        {% if role.users|length > 0 %}
        <div class="table-container mt-3">
            {% embed '_components/_table.html.twig' with {'noMargin': true, 'responsive': true} %}
                {% block table_head %}
                    <tr>
                        <th scope="col">{{ 'role_management.user.name'|trans({}, 'role_management') }}</th>
                        <th scope="col">{{ 'role_management.user.email'|trans({}, 'role_management') }}</th>
                        <th scope="col">{{ 'role_management.user.assigned_date'|trans({}, 'role_management') }}</th>
                    </tr>
                {% endblock %}
                {% block table_body %}
                    {% for user in role.users %}
                    <tr>
                        <td><strong>{{ user.fullName }}</strong></td>
                        <td>{{ user.email|default('-') }}</td>
                        <td>{{ user.roleAssignedAt|date('d.m.Y H:i') }}</td>
                    </tr>
                    {% endfor %}
                {% endblock %}
            {% endembed %}
        </div>
        {% else %}
        <p class="text-muted-mt-sm">
            {{ 'role_management.message.no_users'|trans({}, 'role_management') }}
        </p>
        {% endif %}
    {% endblock %}
{% endembed %}

{# Action Buttons #}
<div class="button-group mt-xl">
    <a href="{{ path('role_management_edit', {id: role.id}) }}" class="btn btn-primary">
        <i class="bi bi-pencil" aria-hidden="true"></i> {{ 'common.edit'|trans({}, 'messages') }}
    </a>
    <a href="{{ path('role_management_index') }}" class="btn btn-secondary">
        <i class="bi bi-list" aria-hidden="true"></i> {{ 'common.back_to_list'|trans({}, 'messages') }}
    </a>
    {% if not role.systemRole %}
    <form method="post" action="{{ path('role_management_delete', {id: role.id}) }}" class="d-inline"
          data-controller="ui-actions"
          data-action="submit->ui-actions#confirm"
          data-ui-actions-message-param="{{ 'role_management.confirm.delete'|trans({}, 'role_management') }}">
        <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ role.id) }}">
        <button type="submit" class="btn btn-danger"><i class="bi bi-trash" aria-hidden="true"></i> {{ 'common.delete'|trans({}, 'messages') }}</button>
    </form>
    {% endif %}
</div>
{% endblock admin_content %}
