{% extends 'base.html.twig' %}
{% trans_default_domain 'analytics' %}

{% block title %}{{ 'analytics.page.title'|trans }} - {{ 'app.title'|trans({}, 'messages') }}{% endblock %}

{% block body %}
<div class="analytics-dashboard" data-controller="analytics">
    {# Page Header #}
    <div class="page-header">
        <div>
            <h1>
                <i class="bi bi-graph-up"></i>
                {{ 'analytics.page.title'|trans }}
            </h1>
            <p class="text-muted">{{ 'analytics.page.subtitle'|trans }}</p>
        </div>
        <div class="page-header-actions">
            {# Time Period Filter #}
            <select class="form-select"
                    data-analytics-target="periodFilter"
                    data-action="change->analytics#changePeriod">
                <option value="6">{{ 'analytics.filter.period.last_6_months'|trans }}</option>
                <option value="12" selected>{{ 'analytics.filter.period.last_12_months'|trans }}</option>
                <option value="24">{{ 'analytics.filter.period.last_24_months'|trans }}</option>
            </select>

            {# Export Dropdown #}
            <div class="dropdown">
                <button class="btn btn-outline-primary dropdown-toggle"
                        type="button"
                        data-bs-toggle="dropdown">
                    <i class="bi bi-download"></i> {{ 'analytics.action.export'|trans }}
                </button>
                <ul class="dropdown-menu">
                    <li>
                        <a class="dropdown-item"
                           href="{{ path('app_analytics_export', {type: 'risks'}) }}"
                           data-turbo="false">
                            <i class="bi bi-exclamation-triangle"></i> {{ 'analytics.action.export_risks_csv'|trans }}
                        </a>
                    </li>
                    <li>
                        <a class="dropdown-item"
                           href="{{ path('app_analytics_export', {type: 'assets'}) }}"
                           data-turbo="false">
                            <i class="bi bi-server"></i> {{ 'analytics.action.export_assets_csv'|trans }}
                        </a>
                    </li>
                    <li>
                        <a class="dropdown-item"
                           href="{{ path('app_analytics_export', {type: 'compliance'}) }}"
                           data-turbo="false">
                            <i class="bi bi-shield-check"></i> {{ 'analytics.action.export_compliance_csv'|trans }}
                        </a>
                    </li>
                    <li><hr class="dropdown-divider"></li>
                    <li>
                        <a class="dropdown-item"
                           href="#"
                           data-action="click->analytics#printDashboard">
                            <i class="bi bi-printer"></i> {{ 'analytics.action.print_dashboard'|trans }}
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    {# Tab Navigation #}
    <ul class="nav nav-tabs analytics-tabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active"
                    data-bs-toggle="tab"
                    data-bs-target="#overview-tab"
                    type="button"
                    role="tab">
                <i class="bi bi-speedometer2"></i> {{ 'analytics.tabs.overview'|trans }}
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link"
                    data-bs-toggle="tab"
                    data-bs-target="#heat-map-tab"
                    type="button"
                    role="tab">
                <i class="bi bi-grid-3x3-gap"></i> {{ 'analytics.tabs.heat_map'|trans }}
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link"
                    data-bs-toggle="tab"
                    data-bs-target="#compliance-tab"
                    type="button"
                    role="tab">
                <i class="bi bi-diagram-3"></i> {{ 'analytics.tabs.compliance_radar'|trans }}
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link"
                    data-bs-toggle="tab"
                    data-bs-target="#trends-tab"
                    type="button"
                    role="tab">
                <i class="bi bi-graph-up-arrow"></i> {{ 'analytics.tabs.trends'|trans }}
            </button>
        </li>
    </ul>

    {# Tab Content #}
    <div class="tab-content analytics-content">
        {# Overview Tab #}
        <div class="tab-pane fade show active"
             id="overview-tab"
             role="tabpanel">
            <div class="row">
                {# Risk Heat Map Card #}
                <div class="col-md-6 mb-4">
                    {% include 'analytics/_risk_heat_map.html.twig' %}
                </div>

                {# Compliance Radar Card #}
                <div class="col-md-6 mb-4">
                    {% include 'analytics/_compliance_radar.html.twig' %}
                </div>
            </div>

            {# Trend Charts Row #}
            <div class="row">
                <div class="col-12">
                    {% include 'analytics/_trend_charts.html.twig' %}
                </div>
            </div>
        </div>

        {# Risk Heat Map Tab #}
        <div class="tab-pane fade"
             id="heat-map-tab"
             role="tabpanel">
            <div class="row">
                <div class="col-12">
                    {% include 'analytics/_risk_heat_map.html.twig' with {expanded: true} %}
                </div>
            </div>
        </div>

        {# Compliance Tab #}
        <div class="tab-pane fade"
             id="compliance-tab"
             role="tabpanel">
            <div class="row">
                <div class="col-12">
                    {% include 'analytics/_compliance_radar.html.twig' with {expanded: true} %}
                </div>
            </div>
        </div>

        {# Trends Tab #}
        <div class="tab-pane fade"
             id="trends-tab"
             role="tabpanel">
            <div class="row">
                <div class="col-12">
                    {% include 'analytics/_trend_charts.html.twig' with {expanded: true} %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
{% endblock %}
