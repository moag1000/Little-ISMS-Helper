{# Compliance Radar Chart Component
   Usage: {% include 'analytics/_compliance_radar.html.twig' %}

   Features:
   - Spider/Radar chart for compliance visualization
   - Shows compliance % per ISO 27001 Annex
   - Overall compliance score
#}
{% trans_default_domain 'analytics' %}

<div class="card analytics-card radar-card {{ expanded is defined and expanded ? 'expanded' : '' }}"
     data-controller="radar-chart"
     data-radar-chart-url-value="{{ path('app_analytics_compliance_radar_data') }}">
    <div class="card-header">
        <h3 class="card-title">
            <i class="bi bi-diagram-3 text-success"></i>
            {{ 'analytics.card.compliance_radar'|trans({}, 'analytics') }}
        </h3>
        <div class="card-actions">
            <button class="btn btn-sm btn-outline-secondary"
                    data-action="click->radar-chart#refresh"
                    title="{{ 'analytics.action.refresh'|trans({}, 'analytics') }}">
                <i class="bi bi-arrow-clockwise" aria-hidden="true"></i>
            </button>
            <button class="btn btn-sm btn-outline-secondary"
                    data-action="click->radar-chart#exportImage"
                    title="{{ 'analytics.action.export_png'|trans({}, 'analytics') }}">
                <i class="bi bi-image" aria-hidden="true"></i>
            </button>
        </div>
    </div>
    <div class="card-body">
        {# Loading State #}
        <div class="radar-loading d-none" data-radar-chart-target="loading">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">{{ 'analytics.loading.loading'|trans({}, 'analytics') }}</span>
            </div>
            <p class="mt-2 text-muted">{{ 'analytics.loading.loading_compliance'|trans({}, 'analytics') }}</p>
        </div>

        {# Radar Chart Container #}
        <div class="radar-container" data-radar-chart-target="container">
            {# Overall Compliance Score #}
            <div class="overall-compliance mb-3" data-radar-chart-target="overall">
                <div class="compliance-label">{{ 'analytics.overall_compliance'|trans({}, 'analytics') }}</div>
                <div class="compliance-value" data-radar-chart-target="overallValue">
                    <span class="value">--</span>%
                </div>
            </div>

            {# Chart Canvas #}
            <canvas data-radar-chart-target="canvas"
                    width="400"
                    height="400"></canvas>

            {# Annex Details Table #}
            <div class="annex-details mt-3">
                {% embed '_components/_table.html.twig' with {
                    'class': 'table-sm',
                    'noMargin': true
                } %}
                    {% block table_head %}
                        <tr>
                            <th scope="col">{{ 'analytics.table.annex'|trans({}, 'analytics') }}</th>
                            <th scope="col">{{ 'analytics.table.implemented'|trans({}, 'analytics') }}</th>
                            <th scope="col">{{ 'analytics.table.total'|trans({}, 'analytics') }}</th>
                            <th scope="col">{{ 'analytics.table.compliance'|trans({}, 'analytics') }}</th>
                        </tr>
                    {% endblock %}
                    {% block table_body_attrs %}data-radar-chart-target="detailsTable"{% endblock %}
                    {% block table_body %}
                        {# Will be populated by JavaScript #}
                    {% endblock %}
                {% endembed %}
            </div>
        </div>
    </div>
</div>
