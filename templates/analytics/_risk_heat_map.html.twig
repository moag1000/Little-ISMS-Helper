{# Risk Heat Map Component
   Usage: {% include 'analytics/_risk_heat_map.html.twig' %}

   Features:
   - 5x5 Matrix (Probability × Impact)
   - Color-coded cells
   - Interactive tooltips
   - Click to view risks
#}

<div class="card analytics-card heat-map-card {{ expanded is defined and expanded ? 'expanded' : '' }}"
     data-controller="heat-map"
     data-heat-map-url-value="{{ path('app_analytics_heat_map_data') }}">
    <div class="card-header">
        <h5 class="card-title">
            <i class="bi-grid-3x3-gap text-danger"></i>
            Risk Heat Map
        </h5>
        <div class="card-actions">
            <button class="btn btn-sm btn-outline-secondary"
                    data-action="click->heat-map#refresh"
                    title="Refresh">
                <i class="bi-arrow-clockwise"></i>
            </button>
            <button class="btn btn-sm btn-outline-secondary"
                    data-action="click->heat-map#exportImage"
                    title="Export as PNG">
                <i class="bi-image"></i>
            </button>
        </div>
    </div>
    <div class="card-body">
        {# Loading State #}
        <div class="heat-map-loading d-none" data-heat-map-target="loading">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2 text-muted">Loading heat map data...</p>
        </div>

        {# Legend #}
        <div class="heat-map-legend" style="display: flex !important; flex-direction: row !important; flex-wrap: wrap !important; gap: 1rem !important; row-gap: 0.75rem !important; justify-content: center !important; align-items: center !important; margin-bottom: 20px !important; padding: 15px !important; background: #f8f9fa !important; border-radius: 8px !important; width: 100% !important;">
            <div class="legend-item" style="display: flex !important; flex-direction: row !important; align-items: center !important; gap: 0.625rem !important; padding: 0.5rem 1rem !important; background: white !important; border: 1px solid #e5e7eb !important; border-radius: 6px !important; white-space: nowrap !important; position: relative !important; box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05) !important; margin: 0 !important; flex: 0 0 auto !important; min-width: fit-content !important;">
                <span class="legend-color" style="background: #fecaca !important; width: 20px !important; height: 20px !important; display: inline-block !important; flex-shrink: 0 !important; flex-grow: 0 !important; border-radius: 3px !important; border: 1px solid rgba(0, 0, 0, 0.1) !important; position: static !important;"></span>
                <span class="legend-label" style="display: inline-block !important; font-size: 0.875rem !important; font-weight: 500 !important; position: static !important; flex-shrink: 0 !important;">Critical (15-25)</span>
            </div>
            <div class="legend-item" style="display: flex !important; flex-direction: row !important; align-items: center !important; gap: 0.625rem !important; padding: 0.5rem 1rem !important; background: white !important; border: 1px solid #e5e7eb !important; border-radius: 6px !important; white-space: nowrap !important; position: relative !important; box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05) !important; margin: 0 !important; flex: 0 0 auto !important; min-width: fit-content !important;">
                <span class="legend-color" style="background: #fed7aa !important; width: 20px !important; height: 20px !important; display: inline-block !important; flex-shrink: 0 !important; flex-grow: 0 !important; border-radius: 3px !important; border: 1px solid rgba(0, 0, 0, 0.1) !important; position: static !important;"></span>
                <span class="legend-label" style="display: inline-block !important; font-size: 0.875rem !important; font-weight: 500 !important; position: static !important; flex-shrink: 0 !important;">High (8-14)</span>
            </div>
            <div class="legend-item" style="display: flex !important; flex-direction: row !important; align-items: center !important; gap: 0.625rem !important; padding: 0.5rem 1rem !important; background: white !important; border: 1px solid #e5e7eb !important; border-radius: 6px !important; white-space: nowrap !important; position: relative !important; box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05) !important; margin: 0 !important; flex: 0 0 auto !important; min-width: fit-content !important;">
                <span class="legend-color" style="background: #fef3c7 !important; width: 20px !important; height: 20px !important; display: inline-block !important; flex-shrink: 0 !important; flex-grow: 0 !important; border-radius: 3px !important; border: 1px solid rgba(0, 0, 0, 0.1) !important; position: static !important;"></span>
                <span class="legend-label" style="display: inline-block !important; font-size: 0.875rem !important; font-weight: 500 !important; position: static !important; flex-shrink: 0 !important;">Medium (4-7)</span>
            </div>
            <div class="legend-item" style="display: flex !important; flex-direction: row !important; align-items: center !important; gap: 0.625rem !important; padding: 0.5rem 1rem !important; background: white !important; border: 1px solid #e5e7eb !important; border-radius: 6px !important; white-space: nowrap !important; position: relative !important; box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05) !important; margin: 0 !important; flex: 0 0 auto !important; min-width: fit-content !important;">
                <span class="legend-color" style="background: #d1fae5 !important; width: 20px !important; height: 20px !important; display: inline-block !important; flex-shrink: 0 !important; flex-grow: 0 !important; border-radius: 3px !important; border: 1px solid rgba(0, 0, 0, 0.1) !important; position: static !important;"></span>
                <span class="legend-label" style="display: inline-block !important; font-size: 0.875rem !important; font-weight: 500 !important; position: static !important; flex-shrink: 0 !important;">Low (1-3)</span>
            </div>
        </div>

        {# Heat Map Container #}
        <div class="heat-map-container" data-heat-map-target="container">
            {# Axis Labels #}
            <div class="heat-map-axes">
                <div class="y-axis-label">
                    <span>Impact →</span>
                </div>
                <div class="x-axis-label">
                    <span>← Probability</span>
                </div>
            </div>

            {# Heat Map Grid #}
            <div class="heat-map-grid" data-heat-map-target="grid">
                {# Will be rendered by JavaScript #}
            </div>
        </div>

        {# Risk Details Modal #}
        <div class="heat-map-details d-none" data-heat-map-target="details">
            <div class="details-header">
                <h6 data-heat-map-target="detailsTitle">Risks in this cell</h6>
                <button class="btn-close btn-sm"
                        data-action="click->heat-map#closeDetails"></button>
            </div>
            <div class="details-body" data-heat-map-target="detailsList">
                {# Will be populated by JavaScript #}
            </div>
        </div>
    </div>
</div>
