{# Risk Heat Map Component
   Usage: {% include 'analytics/_risk_heat_map.html.twig' %}

   Features:
   - 5x5 Matrix (Probability × Impact)
   - Color-coded cells
   - Interactive tooltips
   - Click to view risks
#}

<div class="card analytics-card heat-map-card {{ expanded is defined and expanded ? 'expanded' : '' }}"
     data-controller="heat-map"
     data-heat-map-url-value="{{ path('app_analytics_heat_map_data') }}">
    <div class="card-header">
        <h5 class="card-title">
            <i class="bi-grid-3x3-gap text-danger"></i>
            Risk Heat Map
        </h5>
        <div class="card-actions">
            <button class="btn btn-sm btn-outline-secondary"
                    data-action="click->heat-map#refresh"
                    title="Refresh">
                <i class="bi-arrow-clockwise"></i>
            </button>
            <button class="btn btn-sm btn-outline-secondary"
                    data-action="click->heat-map#exportImage"
                    title="Export as PNG">
                <i class="bi-image"></i>
            </button>
        </div>
    </div>
    <div class="card-body">
        {# Loading State #}
        <div class="heat-map-loading d-none" data-heat-map-target="loading">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2 text-muted">Loading heat map data...</p>
        </div>

        {# Legend #}
        <div class="heat-map-legend" style="display: flex; flex-direction: row; flex-wrap: wrap; gap: 1rem; justify-content: center; align-items: center; margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
            <div class="legend-item" style="display: flex; flex-direction: row; align-items: center; gap: 0.625rem; padding: 0.5rem 1rem; background: white; border: 1px solid #e5e7eb; border-radius: 6px; white-space: nowrap; position: relative; box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);">
                <span class="legend-color" style="background: #fecaca; width: 20px; height: 20px; display: inline-block; flex-shrink: 0; border-radius: 3px; border: 1px solid rgba(0, 0, 0, 0.1);"></span>
                <span class="legend-label" style="display: inline-block; font-size: 0.875rem; font-weight: 500;">Critical (15-25)</span>
            </div>
            <div class="legend-item" style="display: flex; flex-direction: row; align-items: center; gap: 0.625rem; padding: 0.5rem 1rem; background: white; border: 1px solid #e5e7eb; border-radius: 6px; white-space: nowrap; position: relative; box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);">
                <span class="legend-color" style="background: #fed7aa; width: 20px; height: 20px; display: inline-block; flex-shrink: 0; border-radius: 3px; border: 1px solid rgba(0, 0, 0, 0.1);"></span>
                <span class="legend-label" style="display: inline-block; font-size: 0.875rem; font-weight: 500;">High (8-14)</span>
            </div>
            <div class="legend-item" style="display: flex; flex-direction: row; align-items: center; gap: 0.625rem; padding: 0.5rem 1rem; background: white; border: 1px solid #e5e7eb; border-radius: 6px; white-space: nowrap; position: relative; box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);">
                <span class="legend-color" style="background: #fef3c7; width: 20px; height: 20px; display: inline-block; flex-shrink: 0; border-radius: 3px; border: 1px solid rgba(0, 0, 0, 0.1);"></span>
                <span class="legend-label" style="display: inline-block; font-size: 0.875rem; font-weight: 500;">Medium (4-7)</span>
            </div>
            <div class="legend-item" style="display: flex; flex-direction: row; align-items: center; gap: 0.625rem; padding: 0.5rem 1rem; background: white; border: 1px solid #e5e7eb; border-radius: 6px; white-space: nowrap; position: relative; box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);">
                <span class="legend-color" style="background: #d1fae5; width: 20px; height: 20px; display: inline-block; flex-shrink: 0; border-radius: 3px; border: 1px solid rgba(0, 0, 0, 0.1);"></span>
                <span class="legend-label" style="display: inline-block; font-size: 0.875rem; font-weight: 500;">Low (1-3)</span>
            </div>
        </div>

        {# Heat Map Container #}
        <div class="heat-map-container" data-heat-map-target="container">
            {# Axis Labels #}
            <div class="heat-map-axes">
                <div class="y-axis-label">
                    <span>Impact →</span>
                </div>
                <div class="x-axis-label">
                    <span>← Probability</span>
                </div>
            </div>

            {# Heat Map Grid #}
            <div class="heat-map-grid" data-heat-map-target="grid">
                {# Will be rendered by JavaScript #}
            </div>
        </div>

        {# Risk Details Modal #}
        <div class="heat-map-details d-none" data-heat-map-target="details">
            <div class="details-header">
                <h6 data-heat-map-target="detailsTitle">Risks in this cell</h6>
                <button class="btn-close btn-sm"
                        data-action="click->heat-map#closeDetails"></button>
            </div>
            <div class="details-body" data-heat-map-target="detailsList">
                {# Will be populated by JavaScript #}
            </div>
        </div>
    </div>
</div>
