{# Trend Charts Component
   Usage: {% include 'analytics/_trend_charts.html.twig' %}

   Features:
   - Risk trends over time
   - Asset growth trends
   - Incident trends
   - Time period filtering
#}
{% trans_default_domain 'analytics' %}

<div class="card analytics-card trend-card {{ expanded is defined and expanded ? 'expanded' : '' }}"
     data-controller="trend-chart"
     data-trend-chart-url-value="{{ path('app_analytics_trends_data') }}">
    <div class="card-header">
        <h3 class="card-title">
            <i class="bi-graph-up-arrow text-info"></i>
            {{ 'analytics.card.trend_analysis'|trans({}, 'messages') }}
        </h3>
        <div class="card-actions">
            <button class="btn btn-sm btn-outline-secondary"
                    data-action="click->trend-chart#refresh"
                    title="{{ 'analytics.action.refresh'|trans({}, 'messages') }}">
                <i class="bi bi-arrow-clockwise"></i>
            </button>
            <button class="btn btn-sm btn-outline-secondary"
                    data-action="click->trend-chart#exportImage"
                    title="{{ 'analytics.action.export_png'|trans({}, 'messages') }}">
                <i class="bi bi-image"></i>
            </button>
        </div>
    </div>
    <div class="card-body">
        {# Loading State #}
        <div class="trend-loading d-none" data-trend-chart-target="loading">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">{{ 'analytics.loading.loading'|trans({}, 'messages') }}</span>
            </div>
            <p class="mt-2 text-muted">{{ 'analytics.loading.loading_trends'|trans({}, 'messages') }}</p>
        </div>

        {# Trend Charts Container #}
        <div class="trend-container" data-trend-chart-target="container">
            {# Chart Selector Tabs #}
            <ul class="nav nav-pills trend-tabs mb-3">
                <li class="nav-item">
                    <button class="nav-link active"
                            data-action="click->trend-chart#showRiskTrend"
                            data-trend-chart-target="riskTab">
                        <i class="bi bi-exclamation-triangle"></i> {{ 'analytics.trend_tabs.risks'|trans({}, 'messages') }}
                    </button>
                </li>
                <li class="nav-item">
                    <button class="nav-link"
                            data-action="click->trend-chart#showAssetTrend"
                            data-trend-chart-target="assetTab">
                        <i class="bi bi-server"></i> {{ 'analytics.trend_tabs.assets'|trans({}, 'messages') }}
                    </button>
                </li>
                <li class="nav-item">
                    <button class="nav-link"
                            data-action="click->trend-chart#showIncidentTrend"
                            data-trend-chart-target="incidentTab">
                        <i class="bi bi-exclamation-circle"></i> {{ 'analytics.trend_tabs.incidents'|trans({}, 'messages') }}
                    </button>
                </li>
            </ul>

            {# Risk Trend Chart #}
            <div class="trend-chart-wrapper" data-trend-chart-target="riskChart">
                <h4 class="chart-title">{{ 'analytics.chart_title.risk_trends_last_12'|trans({}, 'messages') }}</h4>
                <canvas data-trend-chart-target="riskCanvas"
                        width="800"
                        height="300"></canvas>
                <div class="chart-stats mt-3">
                    <div class="stat-item">
                        <span class="stat-label">{{ 'analytics.stat_label.total_risks'|trans({}, 'messages') }}:</span>
                        <span class="stat-value" data-trend-chart-target="riskTotal">--</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">{{ 'analytics.stat_label.high_risk'|trans({}, 'messages') }}:</span>
                        <span class="stat-value text-danger" data-trend-chart-target="riskHigh">--</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">{{ 'analytics.stat_label.trend'|trans({}, 'messages') }}:</span>
                        <span class="stat-value" data-trend-chart-target="riskTrend">--</span>
                    </div>
                </div>
            </div>

            {# Asset Trend Chart #}
            <div class="trend-chart-wrapper d-none" data-trend-chart-target="assetChart">
                <h4 class="chart-title">{{ 'analytics.chart_title.asset_growth_last_12'|trans({}, 'messages') }}</h4>
                <canvas data-trend-chart-target="assetCanvas"
                        width="800"
                        height="300"></canvas>
                <div class="chart-stats mt-3">
                    <div class="stat-item">
                        <span class="stat-label">{{ 'analytics.stat_label.total_assets'|trans({}, 'messages') }}:</span>
                        <span class="stat-value" data-trend-chart-target="assetTotal">--</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">{{ 'analytics.stat_label.growth'|trans({}, 'messages') }}:</span>
                        <span class="stat-value" data-trend-chart-target="assetGrowth">--</span>
                    </div>
                </div>
            </div>

            {# Incident Trend Chart #}
            <div class="trend-chart-wrapper d-none" data-trend-chart-target="incidentChart">
                <h4 class="chart-title">{{ 'analytics.chart_title.incident_trends_last_12'|trans({}, 'messages') }}</h4>
                <canvas data-trend-chart-target="incidentCanvas"
                        width="800"
                        height="300"></canvas>
                <div class="chart-stats mt-3">
                    <div class="stat-item">
                        <span class="stat-label">{{ 'analytics.stat_label.total_incidents'|trans({}, 'messages') }}:</span>
                        <span class="stat-value" data-trend-chart-target="incidentTotal">--</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">{{ 'analytics.stat_label.critical'|trans({}, 'messages') }}:</span>
                        <span class="stat-value text-danger" data-trend-chart-target="incidentCritical">--</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">{{ 'analytics.stat_label.avg_per_month'|trans({}, 'messages') }}:</span>
                        <span class="stat-value" data-trend-chart-target="incidentAvg">--</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
