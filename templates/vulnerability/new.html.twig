{% extends 'base.html.twig' %}
{% trans_default_domain 'vulnerabilities' %}

{% block title %}{{ 'vulnerability.new'|trans({}, 'vulnerabilities') }} - {{ parent() }}{% endblock %}

{% block body %}
{# Breadcrumb Navigation #}
{% include '_components/_breadcrumb.html.twig' with {
    breadcrumbs: [
        { label: 'vulnerability.title'|trans({}, 'vulnerabilities'), url: path('app_vulnerability_index'), icon: 'bi-bug' },
        { label: 'vulnerability.new'|trans({}, 'vulnerabilities') }
    ]
} %}

{# Page Header #}
{% include '_components/_page_header.html.twig' with {
    title: 'vulnerability.new'|trans({}, 'vulnerabilities'),
    icon: 'bi-plus-circle',
    actions: [
        { label: 'common.back'|trans({}, 'messages'), url: path('app_vulnerability_index'), variant: 'secondary', icon: 'bi-arrow-left' }
    ]
} %}

<div class="card">
    <div class="card-body">
        {{ form_start(form) }}
            {% include '_components/_auto_form.html.twig' with {
                'form': form,
                'sections': {
                    'identification': {
                        'label': 'vulnerability.section.identification'|trans({}, 'vulnerabilities'),
                        'fields': ['cveId', 'title', 'description']
                    },
                    'severity': {
                        'label': 'vulnerability.section.severity'|trans({}, 'vulnerabilities'),
                        'fields': ['severity', 'cvssScore', 'cvssVector']
                    },
                    'status': {
                        'label': 'vulnerability.section.status'|trans({}, 'vulnerabilities'),
                        'fields': ['source', 'status', 'affectedAssets']
                    },
                    'dates': {
                        'label': 'vulnerability.section.dates'|trans({}, 'vulnerabilities'),
                        'fields': ['discoveredDate', 'publishedDate', 'remediationDeadline', 'remediatedDate']
                    },
                    'exploit': {
                        'label': 'vulnerability.section.exploit'|trans({}, 'vulnerabilities'),
                        'fields': ['exploitAvailability', 'activelyExploited']
                    },
                    'remediation': {
                        'label': 'vulnerability.section.remediation'|trans({}, 'vulnerabilities'),
                        'fields': ['responsiblePerson', 'remediationNotes']
                    }
                },
                'col_widths': {
                    'cveId': 4,
                    'title': 8,
                    'description': 12,
                    'severity': 4,
                    'cvssScore': 4,
                    'cvssVector': 4,
                    'source': 6,
                    'status': 6,
                    'affectedAssets': 12,
                    'discoveredDate': 6,
                    'publishedDate': 6,
                    'remediationDeadline': 6,
                    'remediatedDate': 6,
                    'exploitAvailability': 6,
                    'activelyExploited': 6,
                    'responsiblePerson': 12,
                    'remediationNotes': 12
                }
            } %}

            <div class="form-actions d-flex gap-2 justify-content-end">
                <a href="{{ path('app_vulnerability_index') }}" class="btn btn-secondary">
                    <i class="bi bi-x-circle" aria-hidden="true"></i>
                    {{ 'common.cancel'|trans({}, 'messages') }}
                </a>
                <button type="submit" class="btn btn-primary">
                    <i class="bi bi-save" aria-hidden="true"></i>
                    {{ 'common.save'|trans({}, 'messages') }}
                </button>
            </div>
        {{ form_end(form) }}
    </div>
</div>
{% endblock %}
