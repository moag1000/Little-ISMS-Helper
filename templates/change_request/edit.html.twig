{% extends 'base.html.twig' %}
{% trans_default_domain 'change_requests' %}

{% block title %}{{ 'change_request.edit'|trans({}, 'change_requests') }} {{ change_request.changeNumber }} - {{ parent() }}{% endblock %}

{% block body %}
<div class="container-fluid py-4">
    <div class="row">
        <div class="col-lg-10 col-xl-9 mx-auto">
            <nav aria-label="breadcrumb" class="mb-3">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item">
                        <a href="{{ path('app_change_request_index') }}" data-turbo-action="advance">
                            <i class="bi bi-arrow-left-right" aria-hidden="true"></i> {{ 'change_request.title'|trans({}, 'change_requests') }}
                        </a>
                    </li>
                    <li class="breadcrumb-item">
                        <a href="{{ path('app_change_request_show', {id: change_request.id}) }}" data-turbo-action="advance">
                            {{ change_request.changeNumber }}
                        </a>
                    </li>
                    <li class="breadcrumb-item active" aria-current="page">{{ 'common.edit'|trans({}, 'messages') }}</li>
                </ol>
            </nav>

            <div class="d-flex justify-content-between align-items-center mb-4">
                <h1 class="mb-0">
                    <i class="bi bi-pencil" aria-hidden="true"></i>
                    {{ 'change_request.page.edit'|trans({}, 'change_requests') }}: {{ change_request.changeNumber }}
                </h1>
                <div>
                    <a href="{{ path('app_change_request_show', {id: change_request.id}) }}" class="btn btn-outline-secondary" data-turbo-action="advance">
                        <i class="bi bi-eye" aria-hidden="true"></i> {{ 'change_request.action.view'|trans({}, 'change_requests') }}
                    </a>
                </div>
            </div>

            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h2 class="mb-0">{{ 'change_request.edit'|trans({}, 'change_requests') }}</h2>
                </div>
                <div class="card-body">
                    {{ form_start(form, {'attr': {'novalidate': 'novalidate'}}) }}

                    {% include '_components/_auto_form.html.twig' with {
                        'form': form,
                        'sections': {
                            'basic_info': {
                                'label': 'change_request.section.basic_info'|trans({}, 'change_requests'),
                                'fields': ['changeNumber', 'title', 'changeType', 'description', 'justification']
                            },
                            'request_details': {
                                'label': 'change_request.section.request_details'|trans({}, 'change_requests'),
                                'fields': ['requestedBy', 'requestedDate', 'priority', 'status']
                            },
                            'impact_assessment': {
                                'label': 'change_request.section.impact_assessment'|trans({}, 'change_requests'),
                                'fields': ['ismsImpact', 'riskAssessment']
                            },
                            'implementation': {
                                'label': 'change_request.section.implementation'|trans({}, 'change_requests'),
                                'fields': ['implementationPlan', 'rollbackPlan', 'testingRequirements', 'plannedImplementationDate', 'actualImplementationDate', 'implementedBy', 'implementationNotes']
                            },
                            'approval': {
                                'label': 'change_request.section.approval'|trans({}, 'change_requests'),
                                'fields': ['approvedBy', 'approvedDate', 'approvalComments']
                            },
                            'verification_closure': {
                                'label': 'change_request.section.verification_closure'|trans({}, 'change_requests'),
                                'fields': ['verifiedBy', 'verifiedDate', 'verificationResults', 'closedDate', 'closureNotes']
                            }
                        },
                        'col_widths': {
                            'changeNumber': 4,
                            'title': 8,
                            'changeType': 12,
                            'description': 12,
                            'justification': 12,
                            'requestedBy': 6,
                            'requestedDate': 6,
                            'priority': 6,
                            'status': 6,
                            'ismsImpact': 12,
                            'riskAssessment': 12,
                            'implementationPlan': 12,
                            'rollbackPlan': 12,
                            'testingRequirements': 12,
                            'plannedImplementationDate': 6,
                            'actualImplementationDate': 6,
                            'implementedBy': 12,
                            'implementationNotes': 12,
                            'approvedBy': 6,
                            'approvedDate': 6,
                            'approvalComments': 12,
                            'verifiedBy': 6,
                            'verifiedDate': 6,
                            'verificationResults': 12,
                            'closedDate': 6,
                            'closureNotes': 12
                        }
                    } %}

                    {# Form Actions #}
                    <div class="d-flex justify-content-between align-items-center pt-3 border-top">
                        <a href="{{ path('app_change_request_show', {id: change_request.id}) }}" class="btn btn-outline-secondary" data-turbo-action="advance">
                            <i class="bi bi-x-circle" aria-hidden="true"></i> {{ 'common.cancel'|trans({}, 'messages') }}
                        </a>
                        <button type="submit" class="btn btn-primary btn-lg">
                            <i class="bi bi-save" aria-hidden="true"></i> {{ 'common.save'|trans({}, 'messages') }}
                        </button>
                    </div>

                    {{ form_end(form) }}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
