<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>{{ 'pdf.risk.title'|trans({}, 'reports') }}</title>
    <style>
        body { font-family: 'DejaVu Sans', sans-serif; font-size: 10pt; }
        .header {
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 3px solid transparent;
            border-image: linear-gradient(90deg, #06b6d4 0%, #ec4899 50%, #8b5cf6 100%) 1;
            padding-bottom: 10px;
        }
        .header h1 {
            color: #0f172a;
            margin: 0;
            font-size: 20pt;
            text-transform: uppercase;
            letter-spacing: 0.5pt;
        }
        .header .date { color: #666; font-size: 9pt; margin-top: 5px; }
        table { width: 100%; border-collapse: collapse; margin: 10px 0; }
        th {
            background: linear-gradient(90deg, #0f172a 0%, #1e293b 100%);
            color: #06b6d4;
            padding: 8px;
            text-align: left;
            font-size: 9pt;
            border: 1px solid #1e3a8a;
            text-transform: uppercase;
            letter-spacing: 0.3pt;
        }
        td { padding: 8px; border: 1px solid #ddd; font-size: 9pt; }
        tr:nth-child(even) { background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); }
        .risk-critical { background: #fee2e2; font-weight: bold; }
        .risk-high { background: #fed7aa; }
        .risk-medium { background: #fef3c7; }
        .risk-low { background: #d1fae5; }
        .score-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 3px;
            font-weight: bold;
            color: white;
            letter-spacing: 0.3pt;
            border: 1.5pt solid transparent;
        }
        .score-critical {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            border-color: #dc2626;
        }
        .score-high {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            border-color: #d97706;
        }
        .score-medium {
            background: linear-gradient(135deg, #eab308 0%, #ca8a04 100%);
            border-color: #ca8a04;
            color: #fff;
        }
        .score-low {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border-color: #059669;
        }
        .footer { position: fixed; bottom: 20px; text-align: center; font-size: 8pt; color: #666; }
    </style>
</head>
<body>
    <div class="header">
        <h1>{{ 'pdf.risk.title'|trans({}, 'reports') }}</h1>
        <div class="date">{{ 'pdf.common.generated'|trans({}, 'reports') }}: {{ generated_at|date('d.m.Y H:i') }} | {{ 'pdf.common.total'|trans({}, 'reports') }}: {{ risks|length }}</div>
    </div>

    <table>
        <thead>
            <tr>
                <th scope="col">{{ 'pdf.risk.header.id'|trans({}, 'reports') }}</th>
                <th scope="col">{{ 'pdf.risk.header.title'|trans({}, 'reports') }}</th>
                <th scope="col">{{ 'pdf.risk.header.category'|trans({}, 'reports') }}</th>
                <th scope="col">{{ 'pdf.risk.header.likelihood'|trans({}, 'reports') }}</th>
                <th scope="col">{{ 'pdf.risk.header.impact'|trans({}, 'reports') }}</th>
                <th scope="col">{{ 'pdf.risk.header.score'|trans({}, 'reports') }}</th>
                <th scope="col">{{ 'pdf.risk.header.level'|trans({}, 'reports') }}</th>
                <th scope="col">{{ 'pdf.risk.header.treatment'|trans({}, 'reports') }}</th>
                <th scope="col">{{ 'pdf.risk.header.status'|trans({}, 'reports') }}</th>
                <th scope="col">{{ 'pdf.risk.header.owner'|trans({}, 'reports') }}</th>
            </tr>
        </thead>
        <tbody>
            {% for risk in risks %}
            {% set riskLevel = risk.riskScore >= 20 ? 'critical' : (risk.riskScore >= 12 ? 'high' : (risk.riskScore >= 6 ? 'medium' : 'low')) %}
            <tr class="risk-{{ riskLevel }}">
                <td>{{ risk.id }}</td>
                <td>{{ risk.title|slice(0, 40) }}{% if risk.title|length > 40 %}...{% endif %}</td>
                <td>{{ risk.category }}</td>
                <td>{{ risk.probability }}</td>
                <td>{{ risk.impact }}</td>
                <td><span class="score-badge score-{{ riskLevel }}">{{ risk.riskScore }}</span></td>
                <td>{{ riskLevel|upper }}</td>
                <td>{{ risk.treatmentDescription|slice(0, 25)|default('-') }}{% if risk.treatmentDescription|length > 25 %}...{% endif %}</td>
                <td>{{ risk.status }}</td>
                <td>{{ risk.riskOwner ? risk.riskOwner.email|slice(0, 20) : '-' }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div style="margin-top: 30px; padding: 15px; background: #fef3c7; border-left: 4px solid #f59e0b;">
        <strong>{{ 'pdf.risk.legend'|trans({}, 'reports') }}:</strong><br>
        {{ 'pdf.risk.legend_text'|trans({}, 'reports') }}
    </div>

    <div class="footer">
        <p>{{ 'pdf.risk.footer'|trans({}, 'reports') }} | {{ 'pdf.common.page'|trans({}, 'reports') }} {PAGE_NUM}</p>
    </div>
</body>
</html>
