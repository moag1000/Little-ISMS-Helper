{% extends 'base.html.twig' %}

{% block title %}Reports & Compliance{% endblock %}

{% block body %}
<div class="container-fluid">
    {# Breadcrumb Navigation #}
    {% include '_components/_breadcrumb.html.twig' with {
        breadcrumbs: [
            { label: 'Reports & Compliance' }
        ]
    } %}

    {# Page Header #}
    {% include '_components/_page_header.html.twig' with {
        title: 'Reports & Compliance',
        subtitle: 'Übersicht aller verfügbaren Compliance- und Sicherheitsberichte',
        icon: 'bi-file-earmark-bar-graph'
    } %}

    <div class="row">
        {# License Report Card #}
        <div class="col-lg-6 mb-4">
            {% embed '_components/_card.html.twig' with { 'class': 'h-100' } %}
                {% block card_header %}
                    <div class="card-header bg-primary text-white">
                        <h2 class="card-title mb-0">
                            <i class="bi bi-file-text me-2" aria-hidden="true"></i>Lizenzreport
                        </h2>
                    </div>
                {% endblock %}
                {% block card_body %}
                    <p class="card-text">
                        Vollständige Übersicht aller verwendeten Third-Party-Lizenzen und deren Compliance-Status für kommerzielle Nutzung.
                    </p>
                    <div class="mb-3">
                        <div class="text-muted small mb-2 fw-bold">Verfügbare Reports:</div>
                        <ul class="list-unstyled mb-0">
                            <li class="mb-2">
                                <i class="bi bi-file-earmark-text text-primary me-2" aria-hidden="true"></i>
                                <strong>NOTICE.md</strong> - Third-Party Attributions
                            </li>
                            <li class="mb-2">
                                <i class="bi bi-file-earmark-bar-graph text-primary me-2" aria-hidden="true"></i>
                                <strong>Detaillierter Bericht</strong> - Compliance-Analyse
                                {% if license_stats.exists %}
                                    {% include '_components/_badge.html.twig' with { variant: 'success', icon: 'bi-check-circle', content: 'Verfügbar', class: 'ms-2' } %}
                                {% else %}
                                    {% include '_components/_badge.html.twig' with { variant: 'warning', icon: 'bi-exclamation-triangle', content: 'Nicht generiert', class: 'ms-2' } %}
                                {% endif %}
                            </li>
                            <li>
                                <i class="bi bi-bar-chart text-primary me-2" aria-hidden="true"></i>
                                <strong>Zusammenfassung</strong> - Dashboard & Statistiken
                            </li>
                        </ul>
                    </div>
                    {% if license_stats.exists %}
                        <small class="text-muted">
                            <i class="bi bi-calendar me-1" aria-hidden="true"></i>Letzte Aktualisierung: {{ license_stats.updated_at }}
                        </small>
                    {% endif %}
                {% endblock %}
                {% block card_footer %}
                    <div class="card-footer bg-light">
                        <div class="d-grid gap-2">
                            <a href="{{ path('app_licenses') }}" class="btn btn-primary">
                                <i class="bi bi-arrow-right-circle me-1" aria-hidden="true"></i>Lizenzreport öffnen
                            </a>
                        </div>
                    </div>
                {% endblock %}
            {% endembed %}
        </div>

        {# Security Report Card #}
        <div class="col-lg-6 mb-4">
            {% embed '_components/_card.html.twig' with { 'class': 'h-100' } %}
                {% block card_header %}
                    <div class="card-header bg-danger text-white">
                        <h2 class="card-title mb-0">
                            <i class="bi bi-shield-lock me-2" aria-hidden="true"></i>Security Audit Report
                        </h2>
                    </div>
                {% endblock %}
                {% block card_body %}
                    <p class="card-text">
                        Automatisierte Sicherheitsanalyse basierend auf OWASP Top 10 Security Risks mit detaillierten Findings und Empfehlungen.
                    </p>
                    <div class="mb-3">
                        <div class="text-muted small mb-2 fw-bold">Verfügbare Reports:</div>
                        <ul class="list-unstyled mb-0">
                            <li class="mb-2">
                                <i class="bi bi-shield-lock text-danger me-2" aria-hidden="true"></i>
                                <strong>OWASP Top 10:2025 RC1</strong> (Primary)
                                {% if security_stats.owasp_2025.exists %}
                                    {% include '_components/_badge.html.twig' with { variant: 'success', icon: 'bi-check-circle', content: 'Verfügbar', class: 'ms-2' } %}
                                {% else %}
                                    {% include '_components/_badge.html.twig' with { variant: 'warning', icon: 'bi-exclamation-triangle', content: 'Nicht generiert', class: 'ms-2' } %}
                                {% endif %}
                                {% if security_stats.owasp_2025.updated_at %}
                                    <br>
                                    <small class="text-muted ms-4">Aktualisiert: {{ security_stats.owasp_2025.updated_at }}</small>
                                {% endif %}
                            </li>
                            <li>
                                <i class="bi bi-shield-check text-danger me-2" aria-hidden="true"></i>
                                <strong>OWASP Top 10:2021</strong> (Legacy)
                                {% if security_stats.owasp_2021.exists %}
                                    {% include '_components/_badge.html.twig' with { variant: 'success', icon: 'bi-check-circle', content: 'Verfügbar', class: 'ms-2' } %}
                                {% else %}
                                    {% include '_components/_badge.html.twig' with { variant: 'warning', icon: 'bi-exclamation-triangle', content: 'Nicht generiert', class: 'ms-2' } %}
                                {% endif %}
                                {% if security_stats.owasp_2021.updated_at %}
                                    <br>
                                    <small class="text-muted ms-4">Aktualisiert: {{ security_stats.owasp_2021.updated_at }}</small>
                                {% endif %}
                            </li>
                        </ul>
                    </div>
                {% endblock %}
                {% block card_footer %}
                    <div class="card-footer bg-light">
                        <div class="d-grid gap-2">
                            <a href="{{ path('app_security_report') }}" class="btn btn-danger">
                                <i class="bi bi-arrow-right-circle me-1" aria-hidden="true"></i>Security Reports öffnen
                            </a>
                        </div>
                    </div>
                {% endblock %}
            {% endembed %}
        </div>
    </div>

    {# Information & Actions #}
    <div class="row">
        <div class="col-12">
            {% embed '_components/_card.html.twig' %}
                {% block card_header %}
                    <div class="card-header">
                        <h2 class="card-title mb-0">
                            <i class="bi bi-info-circle me-2" aria-hidden="true"></i>Report-Generierung
                        </h2>
                    </div>
                {% endblock %}
                {% block card_body %}
                    <div class="row">
                        <div class="col-md-6 mb-3 mb-md-0">
                            <h3><i class="bi bi-file-text me-2" aria-hidden="true"></i>Lizenzreport aktualisieren</h3>
                            <p class="text-muted small mb-2">
                                Führen Sie das folgende Skript aus, um den Lizenzreport neu zu generieren:
                            </p>
                            <div class="bg-light p-3 rounded">
                                <code>./license-report.sh</code>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h3><i class="bi bi-shield-lock me-2" aria-hidden="true"></i>Security Report aktualisieren</h3>
                            <p class="text-muted small mb-2">
                                Führen Sie das folgende Skript aus, um die Security Reports neu zu generieren:
                            </p>
                            <div class="bg-light p-3 rounded">
                                <code>php scripts/generate-security-audit.php</code>
                            </div>
                        </div>
                    </div>
                {% endblock %}
            {% endembed %}
        </div>
    </div>

    {# Additional Information #}
    <div class="row mt-4">
        <div class="col-12">
            <div class="alert alert-info">
                <div class="d-flex align-items-start">
                    <i class="bi bi-lightbulb fs-4 me-3" aria-hidden="true"></i>
                    <div>
                        <h2 class="alert-heading mb-2">Best Practices</h2>
                        <ul class="mb-0">
                            <li>Aktualisieren Sie den <strong>Lizenzreport</strong> nach jeder Änderung an den Dependencies (composer.json, package.json)</li>
                            <li>Generieren Sie den <strong>Security Report</strong> regelmäßig (mindestens monatlich) und vor jedem Release</li>
                            <li>Dokumentieren Sie alle Findings und deren Behebung für Compliance-Nachweise</li>
                            <li>{{ 'reports.integrate_ci_cd'|trans({}, 'reports') }}</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.card {
    transition: transform 0.2s, box-shadow 0.2s;
}

.card:hover {
    transform: translateY(-5px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.card-footer {
    border-top: 1px solid rgba(0, 0, 0, 0.125);
}

code {
    background-color: #f8f9fa;
    padding: 0.2rem 0.4rem;
    border-radius: 3px;
    font-size: 0.9em;
}
</style>
{% endblock %}
