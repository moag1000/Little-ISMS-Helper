{% extends 'base.html.twig' %}

{% block title %}{{ 'reports.compliance.title'|trans({}, 'reports') }}{% endblock %}

{% block body %}
<div class="container-fluid">
    {# Breadcrumb Navigation #}
    {% include '_components/_breadcrumb.html.twig' with {
        breadcrumbs: [
            { label: 'reports.compliance.title'|trans({}, 'reports') }
        ]
    } %}

    {# Page Header #}
    {% include '_components/_page_header.html.twig' with {
        title: 'reports.compliance.title'|trans({}, 'reports'),
        subtitle: 'reports.compliance.subtitle'|trans({}, 'reports'),
        icon: 'bi-file-earmark-bar-graph'
    } %}

    <div class="row">
        {# License Report Card #}
        <div class="col-lg-6 mb-4">
            {% embed '_components/_card.html.twig' with { 'class': 'h-100' } %}
                {% block card_header %}
                    <div class="card-header bg-primary text-white">
                        <h2 class="card-title mb-0">
                            <i class="bi bi-file-text me-2" aria-hidden="true"></i>{{ 'reports.license_report.title'|trans({}, 'reports') }}
                        </h2>
                    </div>
                {% endblock %}
                {% block card_body %}
                    <p class="card-text">
                        {{ 'reports.license_report.description'|trans({}, 'reports') }}
                    </p>
                    <div class="mb-3">
                        <div class="text-muted small mb-2 fw-bold">{{ 'reports.license_report.available'|trans({}, 'reports') }}</div>
                        <ul class="list-unstyled mb-0">
                            <li class="mb-2">
                                <i class="bi bi-file-earmark-text text-primary me-2" aria-hidden="true"></i>
                                <strong>{{ 'reports.license_report.notice_md'|trans({}, 'reports') }}</strong> - {{ 'reports.license_report.notice_md_desc'|trans({}, 'reports') }}
                            </li>
                            <li class="mb-2">
                                <i class="bi bi-file-earmark-bar-graph text-primary me-2" aria-hidden="true"></i>
                                <strong>{{ 'reports.license_report.detailed_report'|trans({}, 'reports') }}</strong> - {{ 'reports.license_report.detailed_report_desc'|trans({}, 'reports') }}
                                {% if license_stats.exists %}
                                    {% include '_components/_badge.html.twig' with { variant: 'success', icon: 'bi-check-circle', content: 'reports.status.available'|trans({}, 'reports'), class: 'ms-2' } %}
                                {% else %}
                                    {% include '_components/_badge.html.twig' with { variant: 'warning', icon: 'bi-exclamation-triangle', content: 'reports.status.not_generated'|trans({}, 'reports'), class: 'ms-2' } %}
                                {% endif %}
                            </li>
                            <li>
                                <i class="bi bi-bar-chart text-primary me-2" aria-hidden="true"></i>
                                <strong>{{ 'reports.license_report.summary'|trans({}, 'reports') }}</strong> - {{ 'reports.license_report.summary_desc'|trans({}, 'reports') }}
                            </li>
                        </ul>
                    </div>
                    {% if license_stats.exists %}
                        <small class="text-muted">
                            <i class="bi bi-calendar me-1" aria-hidden="true"></i>{{ 'reports.license_report.last_updated'|trans({}, 'reports') }} {{ license_stats.updated_at }}
                        </small>
                    {% endif %}
                {% endblock %}
                {% block card_footer %}
                    <div class="card-footer bg-light">
                        <div class="d-grid gap-2">
                            <a href="{{ path('app_licenses') }}" class="btn btn-primary">
                                <i class="bi bi-arrow-right-circle me-1" aria-hidden="true"></i>{{ 'reports.license_report.open'|trans({}, 'reports') }}
                            </a>
                        </div>
                    </div>
                {% endblock %}
            {% endembed %}
        </div>

        {# Security Report Card #}
        <div class="col-lg-6 mb-4">
            {% embed '_components/_card.html.twig' with { 'class': 'h-100' } %}
                {% block card_header %}
                    <div class="card-header bg-danger text-white">
                        <h2 class="card-title mb-0">
                            <i class="bi bi-shield-lock me-2" aria-hidden="true"></i>{{ 'reports.security_report.title'|trans({}, 'reports') }}
                        </h2>
                    </div>
                {% endblock %}
                {% block card_body %}
                    <p class="card-text">
                        {{ 'reports.security_report.description'|trans({}, 'reports') }}
                    </p>
                    <div class="mb-3">
                        <div class="text-muted small mb-2 fw-bold">{{ 'reports.security_report.available'|trans({}, 'reports') }}</div>
                        <ul class="list-unstyled mb-0">
                            <li class="mb-2">
                                <i class="bi bi-shield-lock text-danger me-2" aria-hidden="true"></i>
                                <strong>{{ 'reports.security_report.owasp_2025'|trans({}, 'reports') }}</strong> {{ 'reports.security_report.owasp_2025_label'|trans({}, 'reports') }}
                                {% if security_stats.owasp_2025.exists %}
                                    {% include '_components/_badge.html.twig' with { variant: 'success', icon: 'bi-check-circle', content: 'reports.status.available'|trans({}, 'reports'), class: 'ms-2' } %}
                                {% else %}
                                    {% include '_components/_badge.html.twig' with { variant: 'warning', icon: 'bi-exclamation-triangle', content: 'reports.status.not_generated'|trans({}, 'reports'), class: 'ms-2' } %}
                                {% endif %}
                                {% if security_stats.owasp_2025.updated_at %}
                                    <br>
                                    <small class="text-muted ms-4">{{ 'reports.security_report.updated'|trans({}, 'reports') }} {{ security_stats.owasp_2025.updated_at }}</small>
                                {% endif %}
                            </li>
                            <li>
                                <i class="bi bi-shield-check text-danger me-2" aria-hidden="true"></i>
                                <strong>{{ 'reports.security_report.owasp_2021'|trans({}, 'reports') }}</strong> {{ 'reports.security_report.owasp_2021_label'|trans({}, 'reports') }}
                                {% if security_stats.owasp_2021.exists %}
                                    {% include '_components/_badge.html.twig' with { variant: 'success', icon: 'bi-check-circle', content: 'reports.status.available'|trans({}, 'reports'), class: 'ms-2' } %}
                                {% else %}
                                    {% include '_components/_badge.html.twig' with { variant: 'warning', icon: 'bi-exclamation-triangle', content: 'reports.status.not_generated'|trans({}, 'reports'), class: 'ms-2' } %}
                                {% endif %}
                                {% if security_stats.owasp_2021.updated_at %}
                                    <br>
                                    <small class="text-muted ms-4">{{ 'reports.security_report.updated'|trans({}, 'reports') }} {{ security_stats.owasp_2021.updated_at }}</small>
                                {% endif %}
                            </li>
                        </ul>
                    </div>
                {% endblock %}
                {% block card_footer %}
                    <div class="card-footer bg-light">
                        <div class="d-grid gap-2">
                            <a href="{{ path('app_security_report') }}" class="btn btn-danger">
                                <i class="bi bi-arrow-right-circle me-1" aria-hidden="true"></i>{{ 'reports.security_report.open'|trans({}, 'reports') }}
                            </a>
                        </div>
                    </div>
                {% endblock %}
            {% endembed %}
        </div>
    </div>

    {# Information & Actions #}
    <div class="row">
        <div class="col-12">
            {% embed '_components/_card.html.twig' %}
                {% block card_header %}
                    <div class="card-header">
                        <h2 class="card-title mb-0">
                            <i class="bi bi-info-circle me-2" aria-hidden="true"></i>{{ 'reports.generation.title'|trans({}, 'reports') }}
                        </h2>
                    </div>
                {% endblock %}
                {% block card_body %}
                    <div class="row">
                        <div class="col-md-6 mb-3 mb-md-0">
                            <h3><i class="bi bi-file-text me-2" aria-hidden="true"></i>{{ 'reports.license_report.update_title'|trans({}, 'reports') }}</h3>
                            <p class="text-muted small mb-2">
                                {{ 'reports.license_report.update_description'|trans({}, 'reports') }}
                            </p>
                            <div class="bg-light p-3 rounded">
                                <code>./license-report.sh</code>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h3><i class="bi bi-shield-lock me-2" aria-hidden="true"></i>{{ 'reports.security_report.update_title'|trans({}, 'reports') }}</h3>
                            <p class="text-muted small mb-2">
                                {{ 'reports.security_report.update_description'|trans({}, 'reports') }}
                            </p>
                            <div class="bg-light p-3 rounded">
                                <code>php scripts/generate-security-audit.php</code>
                            </div>
                        </div>
                    </div>
                {% endblock %}
            {% endembed %}
        </div>
    </div>

    {# Additional Information #}
    <div class="row mt-4">
        <div class="col-12">
            <div class="alert alert-info">
                <div class="d-flex align-items-start">
                    <i class="bi bi-lightbulb fs-4 me-3" aria-hidden="true"></i>
                    <div>
                        <h2 class="alert-heading mb-2">{{ 'reports.generation.best_practices.title'|trans({}, 'reports') }}</h2>
                        <ul class="mb-0">
                            <li>{{ 'reports.generation.best_practices.license_report'|trans({}, 'reports')|raw }}</li>
                            <li>{{ 'reports.generation.best_practices.security_report'|trans({}, 'reports')|raw }}</li>
                            <li>{{ 'reports.generation.best_practices.document_findings'|trans({}, 'reports') }}</li>
                            <li>{{ 'reports.integrate_ci_cd'|trans({}, 'reports') }}</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.card {
    transition: transform 0.2s, box-shadow 0.2s;
}

.card:hover {
    transform: translateY(-5px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.card-footer {
    border-top: 1px solid rgba(0, 0, 0, 0.125);
}

code {
    background-color: #f8f9fa;
    padding: 0.2rem 0.4rem;
    border-radius: 3px;
    font-size: 0.9em;
}
</style>
{% endblock %}
