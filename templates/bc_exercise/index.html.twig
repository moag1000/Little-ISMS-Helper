{% extends 'base.html.twig' %}
{% trans_default_domain 'bc_exercises' %}
{% import '_macros/cards.html.twig' as cards %}

{% block title %}{{ 'bc_exercises.page.title'|trans({}, 'bc_exercises') }}{% endblock %}

{% block body %}
<div class="container">
    {% include '_components/_breadcrumb.html.twig' with {
        breadcrumbs: [
            { label: 'nav.bcm'|trans({}, 'nav'), url: path('app_bcm_index') },
            { label: 'nav.bc_exercises'|trans({}, 'nav') }
        ]
    } %}

    <div class="page-header">
        <h1>{{ 'bc_exercises.page.header'|trans({}, 'bc_exercises') }}</h1>
        <a href="{{ path('app_bc_exercise_new') }}" class="btn btn-primary">{{ 'bc_exercises.action.add_new'|trans({}, 'bc_exercises') }}</a>
    </div>

    {% if statistics %}
    <div class="row mb-4">
        <div class="col-md-4">
            {{ cards.kpi_card(('bc_exercises.stats.total'|trans({}, 'bc_exercises')), statistics.total, null, null, 'primary', null) }}
        </div>
        <div class="col-md-4">
            {{ cards.kpi_card(('bc_exercises.stats.completed'|trans({}, 'bc_exercises')), statistics.completed, null, null, 'success', null) }}
        </div>
        <div class="col-md-4">
            {{ cards.kpi_card(('bc_exercises.stats.planned'|trans({}, 'bc_exercises')), statistics.planned, null, null, 'info', null) }}
        </div>
    </div>
    {% endif %}

    {% if upcoming|length > 0 %}
    <div class="info-box">
        <h2>{{ 'bc_exercises.section.upcoming'|trans({}, 'bc_exercises') }}</h2>
        <ul>
            {% for exercise in upcoming %}
            <li>
                <a href="{{ path('app_bc_exercise_show', {id: exercise.id}) }}">{{ exercise.name }}</a>
                - {{ exercise.exerciseDate|date('Y-m-d') }} ({{ exercise.exerciseType }})
            </li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    {% if incomplete_reports|length > 0 %}
    <div class="alert alert-warning">
        <h4><i class="bi bi-exclamation-triangle text-warning" aria-hidden="true"></i> {{ 'bc_exercises.section.incomplete_reports'|trans({}, 'bc_exercises') }}</h4>
        <ul>
            {% for exercise in incomplete_reports %}
            <li>
                <a href="{{ path('app_bc_exercise_show', {id: exercise.id}) }}">{{ exercise.name }}</a>
            </li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    <div class="card">
        <div class="card-header">
            <h2>{{ 'bc_exercises.page.header'|trans({}, 'bc_exercises') }} ({{ bc_exercises|length }})</h2>
        </div>
        <div class="card-body">
            {% if bc_exercises|length > 0 %}
            {% embed '_components/_table.html.twig' with {
                'wrapperClass': 'card-body',
                'noMargin': true
            } %}
                {% block table_head %}
                    <tr>
                        <th scope="col">{{ 'bc_exercises.table.name'|trans({}, 'bc_exercises') }}</th>
                        <th scope="col">{{ 'bc_exercises.table.type'|trans({}, 'bc_exercises') }}</th>
                        <th scope="col">{{ 'bc_exercises.table.date'|trans({}, 'bc_exercises') }}</th>
                        <th scope="col">{{ 'bc_exercises.table.status'|trans({}, 'bc_exercises') }}</th>
                        <th scope="col">{{ 'bc_exercises.table.effectiveness'|trans({}, 'bc_exercises') }}</th>
                        <th scope="col">{{ 'common.actions'|trans({}, 'messages') }}</th>
                    </tr>
                {% endblock %}
                {% block table_body %}
                    {% for exercise in bc_exercises %}
                    <tr>
                        <td><a href="{{ path('app_bc_exercise_show', {id: exercise.id}) }}">{{ exercise.name }}</a></td>
                        <td><span class="badge bg-info">{{ exercise.exerciseType }}</span></td>
                        <td>{{ exercise.exerciseDate|date('Y-m-d') }}</td>
                        <td><span class="{{ badge_status(exercise.status) }}">{{ exercise.status }}</span></td>
                        <td>
                            {% if exercise.status == 'completed' %}
                                {{ exercise.getEffectivenessScore() }}%
                            {% else %}
                                {{ 'bc_exercises.message.na'|trans({}, 'bc_exercises') }}
                            {% endif %}
                        </td>
                        <td>
                            <a href="{{ path('app_bc_exercise_show', {id: exercise.id}) }}" class="btn btn-sm btn-secondary">{{ 'common.view'|trans({}, 'messages') }}</a>
                            <a href="{{ path('app_bc_exercise_edit', {id: exercise.id}) }}" class="btn btn-sm btn-primary">{{ 'common.edit'|trans({}, 'messages') }}</a>
                        </td>
                    </tr>
                    {% endfor %}
                {% endblock %}
            {% endembed %}
            {% else %}
            <p>{{ 'bc_exercises.message.no_exercises'|trans({}, 'bc_exercises') }}. <a href="{{ path('app_bc_exercise_new') }}">{{ 'bc_exercises.message.schedule_first'|trans({}, 'bc_exercises') }}</a>.</p>
            {% endif %}
        </div>
    </div>
</div>

<style>
.stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1rem; }
.stat-item { display: flex; flex-direction: column; padding: 1rem; background: var(--bg-secondary); border-radius: 4px; }
.stat-label { font-size: 0.875rem; color: var(--color-text-muted); }
.stat-value { font-size: 1.5rem; font-weight: bold; color: var(--text-primary); }
</style>
{% endblock %}
