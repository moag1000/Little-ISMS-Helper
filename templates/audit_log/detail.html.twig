{% extends 'admin/layout.html.twig' %}

{% block admin_title %}{{ 'audit_log.title'|trans({}, 'audits') }}{% endblock %}
{% block admin_subtitle %}
    <p class="text-muted">{{ 'audit_log.detail.subtitle'|trans({}, 'audits')|default('Detailansicht eines Protokolleintrags') }}</p>
{% endblock %}


{% block admin_content %}
<p>
    <a href="{{ path('app_audit_log_index') }}" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left" aria-hidden="true"></i> {{ 'common.back_to_overview'|trans({}, 'messages') }}
    </a>
</p>

<div class="info-box mt-2">
    <h1>{{ 'audit_log.entry'|trans({'%id%': auditLog.id}, 'audits') }}</h1>

    {% embed '_components/_table.html.twig' with {
        'class': 'w-100 mt-lg',
        'noMargin': true,
        'responsive': true
    } %}
        {% block table_body %}
            <tr>
                <td class="p-sm fw-bold w-200px">{{ 'audit_log.field.timestamp'|trans({}, 'audits') }}</td>
                <td class="p-sm">{{ auditLog.createdAt|date('d.m.Y H:i:s') }}</td>
            </tr>
            <tr>
                <td class="p-sm fw-bold">{{ 'audit_log.field.action'|trans({}, 'audits') }}</td>
                <td class="p-sm">
                    <span class="badge badge-{{ auditLog.action }}">{{ auditLog.action|capitalize }}</span>
                </td>
            </tr>
            <tr>
                <td class="p-sm fw-bold">{{ 'audit_log.field.entity_type'|trans({}, 'audits') }}</td>
                <td class="p-sm">{{ auditLog.entityType }}</td>
            </tr>
            {% if auditLog.entityId %}
            <tr>
                <td class="p-sm fw-bold">{{ 'audit_log.field.entity_id'|trans({}, 'audits') }}</td>
                <td class="p-sm">
                    <a href="{{ path('app_audit_log_entity', {entityType: auditLog.entityType, entityId: auditLog.entityId}) }}"
                       class="link-primary">
                        #{{ auditLog.entityId }}
                    </a>
                </td>
            </tr>
            {% endif %}
            <tr>
                <td class="p-sm fw-bold">{{ 'audit_log.field.user'|trans({}, 'audits') }}</td>
                <td class="p-sm">
                    <a href="{{ path('app_audit_log_user', {userName: auditLog.userName}) }}"
                       class="link-primary">
                        {{ auditLog.userName }}
                    </a>
                </td>
            </tr>
            {% if auditLog.ipAddress %}
            <tr>
                <td class="p-sm fw-bold">{{ 'audit_log.field.ip_address'|trans({}, 'audits') }}</td>
                <td class="p-sm">{{ auditLog.ipAddress }}</td>
            </tr>
            {% endif %}
            {% if auditLog.userAgent %}
            <tr>
                <td class="p-sm fw-bold">{{ 'audit_log.field.user_agent'|trans({}, 'audits') }}</td>
                <td class="p-sm fs-09">{{ auditLog.userAgent }}</td>
            </tr>
            {% endif %}
            {% if auditLog.description %}
            <tr>
                <td class="p-sm fw-bold">{{ 'audit_log.field.description'|trans({}, 'audits') }}</td>
                <td class="p-sm">{{ auditLog.description }}</td>
            </tr>
            {% endif %}
        {% endblock %}
    {% endembed %}
</div>

{% set oldValues = auditLog.oldValuesArray %}
{% set newValues = auditLog.newValuesArray %}

{% if oldValues or newValues %}
<div class="info-box mt-2">
    <h2>{{ 'audit_log.changes'|trans({}, 'audits') }}</h2>

    <div class="grid-2-cols mt-lg">
        {% if oldValues %}
        <div>
            <h4 class="text-danger">{{ 'audit_log.old_values'|trans({}, 'audits') }}</h4>
            {% embed '_components/_table.html.twig' with {
                'class': 'table-collapse-mt',
                'noMargin': true
            } %}
                {% block table_body %}
                    {% for key, value in oldValues %}
                    <tr>
                        <td class="table-cell-header">
                            {{ key }}
                        </td>
                        <td class="table-cell-sm">
                            {{ value|default('-') }}
                        </td>
                    </tr>
                    {% endfor %}
                {% endblock %}
            {% endembed %}
        </div>
        {% endif %}

        {% if newValues %}
        <div>
            <h4 class="text-success">{{ 'audit_log.new_values'|trans({}, 'audits') }}</h4>
            {% embed '_components/_table.html.twig' with {
                'class': 'table-collapse-mt',
                'noMargin': true
            } %}
                {% block table_body %}
                    {% for key, value in newValues %}
                    <tr>
                        <td class="table-cell-header">
                            {{ key }}
                        </td>
                        <td class="table-cell-sm">
                            {{ value|default('-') }}
                        </td>
                    </tr>
                    {% endfor %}
                {% endblock %}
            {% endembed %}
        </div>
        {% endif %}
    </div>
</div>
{% endif %}

{% endblock %}
