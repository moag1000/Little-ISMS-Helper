{% extends 'base.html.twig' %}

{% block title %}{{ 'audit_log.title'|trans }} - {{ 'app.title'|trans }}{% endblock %}

{% block body %}
<h1>{{ 'audit_log.title'|trans }}</h1>

<p>
    <a href="{{ path('app_audit_log_index') }}" class="link-primary">Â« {{ 'common.back_to_overview'|trans }}</a>
</p>

<div class="info-box" style="margin-top: 2rem;">
    <h3>{{ 'audit_log.entry'|trans({'%id%': auditLog.id}) }}</h3>

    <table style="width: 100%; margin-top: 1rem;">
        <tr>
            <td style="padding: 0.5rem; font-weight: bold; width: 200px;">{{ 'audit_log.field.timestamp'|trans }}</td>
            <td style="padding: 0.5rem;">{{ auditLog.createdAt|date('d.m.Y H:i:s') }}</td>
        </tr>
        <tr>
            <td style="padding: 0.5rem; font-weight: bold;">{{ 'audit_log.field.action'|trans }}</td>
            <td style="padding: 0.5rem;">
                <span class="badge badge-{{ auditLog.action }}">{{ auditLog.action|capitalize }}</span>
            </td>
        </tr>
        <tr>
            <td style="padding: 0.5rem; font-weight: bold;">{{ 'audit_log.field.entity_type'|trans }}</td>
            <td style="padding: 0.5rem;">{{ auditLog.entityType }}</td>
        </tr>
        {% if auditLog.entityId %}
        <tr>
            <td style="padding: 0.5rem; font-weight: bold;">{{ 'audit_log.field.entity_id'|trans }}</td>
            <td style="padding: 0.5rem;">
                <a href="{{ path('app_audit_log_entity', {entityType: auditLog.entityType, entityId: auditLog.entityId}) }}"
                   class="link-primary">
                    #{{ auditLog.entityId }}
                </a>
            </td>
        </tr>
        {% endif %}
        <tr>
            <td style="padding: 0.5rem; font-weight: bold;">{{ 'audit_log.field.user'|trans }}</td>
            <td style="padding: 0.5rem;">
                <a href="{{ path('app_audit_log_user', {userName: auditLog.userName}) }}"
                   class="link-primary">
                    {{ auditLog.userName }}
                </a>
            </td>
        </tr>
        {% if auditLog.ipAddress %}
        <tr>
            <td style="padding: 0.5rem; font-weight: bold;">{{ 'audit_log.field.ip_address'|trans }}</td>
            <td style="padding: 0.5rem;">{{ auditLog.ipAddress }}</td>
        </tr>
        {% endif %}
        {% if auditLog.userAgent %}
        <tr>
            <td style="padding: 0.5rem; font-weight: bold;">{{ 'audit_log.field.user_agent'|trans }}</td>
            <td style="padding: 0.5rem; font-size: 0.9rem;">{{ auditLog.userAgent }}</td>
        </tr>
        {% endif %}
        {% if auditLog.description %}
        <tr>
            <td style="padding: 0.5rem; font-weight: bold;">{{ 'audit_log.field.description'|trans }}</td>
            <td style="padding: 0.5rem;">{{ auditLog.description }}</td>
        </tr>
        {% endif %}
    </table>
</div>

{% set oldValues = auditLog.oldValuesArray %}
{% set newValues = auditLog.newValuesArray %}

{% if oldValues or newValues %}
<div class="info-box" style="margin-top: 2rem;">
    <h3>{{ 'audit_log.changes'|trans }}</h3>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-top: 1rem;">
        {% if oldValues %}
        <div>
            <h4 style="color: #dc3545;">{{ 'audit_log.old_values'|trans }}</h4>
            <table style="width: 100%; border-collapse: collapse; margin-top: 0.5rem;">
                {% for key, value in oldValues %}
                <tr>
                    <td style="padding: 0.5rem; border: 1px solid #ddd; font-weight: bold; background: #f8f9fa;">
                        {{ key }}
                    </td>
                    <td style="padding: 0.5rem; border: 1px solid #ddd;">
                        {{ value|default('-') }}
                    </td>
                </tr>
                {% endfor %}
            </table>
        </div>
        {% endif %}

        {% if newValues %}
        <div>
            <h4 style="color: #28a745;">{{ 'audit_log.new_values'|trans }}</h4>
            <table style="width: 100%; border-collapse: collapse; margin-top: 0.5rem;">
                {% for key, value in newValues %}
                <tr>
                    <td style="padding: 0.5rem; border: 1px solid #ddd; font-weight: bold; background: #f8f9fa;">
                        {{ key }}
                    </td>
                    <td style="padding: 0.5rem; border: 1px solid #ddd;">
                        {{ value|default('-') }}
                    </td>
                </tr>
                {% endfor %}
            </table>
        </div>
        {% endif %}
    </div>
</div>
{% endif %}

<style>
.badge {
    display: inline-block;
    padding: 0.25rem 0.5rem;
    border-radius: 3px;
    font-size: 0.85rem;
    font-weight: 500;
}
.badge-create { background: #28a745; color: white; }
.badge-update { background: #ffc107; color: #000; }
.badge-delete { background: #dc3545; color: white; }
.badge-view { background: #17a2b8; color: white; }
.badge-export { background: #6c757d; color: white; }
.badge-import { background: #6f42c1; color: white; }
</style>

{% endblock %}
