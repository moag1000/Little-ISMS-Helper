{% extends 'base.html.twig' %}
{% trans_default_domain 'privacy' %}
{% block title %}{{ 'dpia.new.title'|trans({}, 'privacy')}}{% endblock %}

{% block body %}
<div class="container-fluid mt-4">
    {% include '_components/_breadcrumb.html.twig' with {
        breadcrumbs: [
            { label: 'dpia.new.breadcrumb_gdpr'|trans({}, 'privacy'), icon: 'bi-shield-check' },
            { label: 'dpia.new.breadcrumb_dpia'|trans({}, 'privacy'), url: path('app_dpia_index') },
            { label: 'dpia.new.breadcrumb_new'|trans({}, 'privacy') }
        ]
    } %}

    {% include '_components/_page_header.html.twig' with {
        title: 'dpia.new.page_title'|trans({}, 'privacy'),
        subtitle: 'dpia.new.page_subtitle'|trans({}, 'privacy'),
        icon: 'bi-plus-circle',
        actions: [
            { label: 'dpia.new.button_cancel'|trans({}, 'privacy'), url: path('app_dpia_index'), variant: 'secondary', icon: 'bi-x-lg' }
        ]
    } %}

    <div class="card">
        <div class="card-header"><h3 class="h5 mb-0"><i class="bi bi-clipboard-check"></i> {{ 'dpia.new.form_title'|trans({}, 'privacy')}}</h3>
        </div>
        <div class="card-body">
            {{ form_start(form) }}
                {% include '_components/_auto_form.html.twig' with {
                    'form': form,
                    'sections': {
                        'basic_info': {
                            'label': ('<i class="bi bi-info-circle" aria-hidden="true"></i> ' ~ 'dpia.new.section_basic_info'|trans({}, 'privacy'))|raw,
                            'fields': ['title', 'referenceNumber', 'processingActivity']
                        },
                        'processing_operations': {
                            'label': ('<i class="bi bi-gear" aria-hidden="true"></i> ' ~ 'dpia.new.section_processing_operations'|trans({}, 'privacy'))|raw,
                            'fields': ['processingDescription', 'processingPurposes', 'dataCategories', 'dataSubjectCategories', 'estimatedDataSubjects', 'dataRetentionPeriod', 'dataFlowDescription']
                        },
                        'necessity_proportionality': {
                            'label': ('<i class="bi bi-balance-scale" aria-hidden="true"></i> ' ~ 'dpia.new.section_necessity_proportionality'|trans({}, 'privacy'))|raw,
                            'fields': ['necessityAssessment', 'proportionalityAssessment', 'legalBasis', 'legislativeCompliance']
                        },
                        'risk_assessment': {
                            'label': ('<i class="bi bi-exclamation-triangle" aria-hidden="true"></i> ' ~ 'dpia.new.section_risk_assessment'|trans({}, 'privacy'))|raw,
                            'fields': ['riskLevel', 'likelihood', 'impact', 'dataSubjectRisks']
                        },
                        'measures': {
                            'label': ('<i class="bi bi-shield-check" aria-hidden="true"></i> ' ~ 'dpia.new.section_measures'|trans({}, 'privacy'))|raw,
                            'fields': ['technicalMeasures', 'organizationalMeasures', 'implementedControls', 'complianceMeasures', 'residualRiskAssessment', 'residualRiskLevel']
                        },
                        'consultation': {
                            'label': ('<i class="bi bi-people" aria-hidden="true"></i> ' ~ 'dpia.new.section_consultation'|trans({}, 'privacy'))|raw,
                            'fields': ['dataProtectionOfficer', 'dpoConsultationDate', 'dpoAdvice', 'dataSubjectsConsulted', 'dataSubjectConsultationDetails']
                        },
                        'supervisory': {
                            'label': ('<i class="bi bi-building" aria-hidden="true"></i> ' ~ 'dpia.new.section_supervisory'|trans({}, 'privacy'))|raw,
                            'fields': ['requiresSupervisoryConsultation', 'supervisoryConsultationDate', 'supervisoryAuthorityFeedback']
                        },
                        'workflow': {
                            'label': ('<i class="bi bi-arrow-repeat" aria-hidden="true"></i> ' ~ 'dpia.new.section_workflow'|trans({}, 'privacy'))|raw,
                            'fields': ['conductor', 'reviewFrequencyMonths', 'nextReviewDate']
                        }
                    },
                    'col_widths': {
                        'title': 8,
                        'referenceNumber': 4,
                        'processingActivity': 12,
                        'processingDescription': 12,
                        'processingPurposes': 12,
                        'dataCategories': 12,
                        'dataSubjectCategories': 12,
                        'estimatedDataSubjects': 6,
                        'dataRetentionPeriod': 6,
                        'dataFlowDescription': 12,
                        'necessityAssessment': 12,
                        'proportionalityAssessment': 12,
                        'legalBasis': 6,
                        'legislativeCompliance': 6,
                        'riskLevel': 4,
                        'likelihood': 4,
                        'impact': 4,
                        'dataSubjectRisks': 12,
                        'technicalMeasures': 12,
                        'organizationalMeasures': 12,
                        'implementedControls': 12,
                        'complianceMeasures': 12,
                        'residualRiskAssessment': 6,
                        'residualRiskLevel': 6,
                        'dataProtectionOfficer': 6,
                        'dpoConsultationDate': 6,
                        'dpoAdvice': 12,
                        'dataSubjectsConsulted': 12,
                        'dataSubjectConsultationDetails': 12,
                        'requiresSupervisoryConsultation': 12,
                        'supervisoryConsultationDate': 6,
                        'supervisoryAuthorityFeedback': 6,
                        'conductor': 12,
                        'reviewFrequencyMonths': 6,
                        'nextReviewDate': 6
                    },
                    'translation_domain': 'privacy'
                } %}

                <div class="mt-4">
                    <button type="submit" class="btn btn-success">
                        <i class="bi bi-save"></i> {{ 'dpia.new.button_create'|trans({}, 'privacy')}}
                    </button>
                    <a href="{{ path('app_dpia_index') }}" class="btn btn-secondary">
                        <i class="bi bi-x-lg"></i> {{ 'dpia.new.button_cancel_bottom'|trans({}, 'privacy')}}
                    </a>
                </div>
            {{ form_end(form) }}
        </div>
    </div>
</div>
{% endblock %}
