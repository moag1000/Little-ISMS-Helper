<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Audit Management Report</title>
    <style>
        body { font-family: 'DejaVu Sans', sans-serif; font-size: 9pt; margin: 0; padding: 15px; }
        .header {
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 3px solid #d97706;
            padding-bottom: 10px;
        }
        .header h1 { color: #0f172a; margin: 0; font-size: 18pt; }
        .header .date { color: #888; font-size: 9pt; margin-top: 3px; }

        .stats-grid { display: table; width: 100%; margin: 15px 0; }
        .stat-box {
            display: table-cell;
            width: 25%;
            padding: 10px;
            border: 1px solid #cbd5e1;
            text-align: center;
        }
        .stat-box .number { font-size: 24pt; font-weight: bold; }
        .stat-box .label { font-size: 7pt; color: #666; text-transform: uppercase; }

        .section { margin: 15px 0; page-break-inside: avoid; }
        .section h2 { background: #d97706; color: white; padding: 6px; font-size: 10pt; margin: 0 0 8px 0; }

        table { width: 100%; border-collapse: collapse; margin: 8px 0; }
        th { background: #0f172a; color: #06b6d4; padding: 5px; text-align: left; font-size: 8pt; }
        td { padding: 5px; border-bottom: 1px solid #ddd; font-size: 8pt; }
        tr:nth-child(even) { background: #f8fafc; }

        .badge { display: inline-block; padding: 2px 5px; border-radius: 3px; font-size: 7pt; font-weight: bold; }
        .badge-success { background: #dcfce7; color: #166534; }
        .badge-warning { background: #fef3c7; color: #92400e; }
        .badge-info { background: #e0f2fe; color: #0369a1; }
        .badge-secondary { background: #e5e7eb; color: #374151; }
        .badge-danger { background: #fecaca; color: #991b1b; }

        .progress-bar { background: #e5e7eb; height: 12px; border-radius: 6px; overflow: hidden; }
        .progress-fill { height: 100%; border-radius: 6px; }

        .footer { position: fixed; bottom: 10px; left: 15px; right: 15px; text-align: center; font-size: 7pt; color: #888; border-top: 1px solid #ddd; padding-top: 5px; }
    </style>
</head>
<body>
    <div class="header">
        <h1>Audit Management Report</h1>
        <div class="date">Generated: {{ generated_at|date('d.m.Y H:i') }} | Version: {{ version }}</div>
    </div>

    {# Summary Statistics #}
    <div class="stats-grid">
        <div class="stat-box">
            <div class="number" style="color: #0ea5e9;">{{ report.audits.total }}</div>
            <div class="label">Total Audits</div>
        </div>
        <div class="stat-box">
            <div class="number" style="color: #16a34a;">{{ report.audits.this_year }}</div>
            <div class="label">This Year</div>
        </div>
        <div class="stat-box">
            <div class="number" style="color: #0ea5e9;">{{ report.management_reviews.total }}</div>
            <div class="label">Mgmt Reviews</div>
        </div>
        <div class="stat-box">
            <div class="number" style="color: #d97706;">{{ report.management_reviews.this_year }}</div>
            <div class="label">Reviews This Year</div>
        </div>
    </div>

    {# Audit Status Breakdown #}
    <div class="section">
        <h2>Audit Status Breakdown</h2>
        <table>
            <tr>
                <th>Status</th>
                <th>Count</th>
                <th>Distribution</th>
            </tr>
            <tr>
                <td><span class="badge badge-secondary">Planned</span></td>
                <td>{{ report.audits.by_status.planned }}</td>
                <td>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: {{ report.audits.total > 0 ? (report.audits.by_status.planned / report.audits.total * 100) : 0 }}%; background: #9ca3af;"></div>
                    </div>
                </td>
            </tr>
            <tr>
                <td><span class="badge badge-info">In Progress</span></td>
                <td>{{ report.audits.by_status.in_progress }}</td>
                <td>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: {{ report.audits.total > 0 ? (report.audits.by_status.in_progress / report.audits.total * 100) : 0 }}%; background: #0ea5e9;"></div>
                    </div>
                </td>
            </tr>
            <tr>
                <td><span class="badge badge-success">Completed</span></td>
                <td>{{ report.audits.by_status.completed }}</td>
                <td>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: {{ report.audits.total > 0 ? (report.audits.by_status.completed / report.audits.total * 100) : 0 }}%; background: #16a34a;"></div>
                    </div>
                </td>
            </tr>
            <tr>
                <td><span class="badge badge-danger">Cancelled</span></td>
                <td>{{ report.audits.by_status.cancelled }}</td>
                <td>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: {{ report.audits.total > 0 ? (report.audits.by_status.cancelled / report.audits.total * 100) : 0 }}%; background: #dc2626;"></div>
                    </div>
                </td>
            </tr>
        </table>
    </div>

    {# ISO 27001 Clause 9 Compliance #}
    <div class="section">
        <h2>ISO 27001 Clause 9 Compliance</h2>
        <table>
            <tr>
                <th>Requirement</th>
                <th>Reference</th>
                <th>Status</th>
            </tr>
            <tr>
                <td>Internal Audit Program</td>
                <td>Clause 9.2</td>
                <td>
                    {% if report.audits.this_year >= 1 %}
                    <span class="badge badge-success">Compliant</span>
                    {% else %}
                    <span class="badge badge-warning">Pending</span>
                    {% endif %}
                </td>
            </tr>
            <tr>
                <td>Management Review</td>
                <td>Clause 9.3</td>
                <td>
                    {% if report.management_reviews.this_year >= 1 %}
                    <span class="badge badge-success">Compliant</span>
                    {% else %}
                    <span class="badge badge-warning">Pending</span>
                    {% endif %}
                </td>
            </tr>
            <tr>
                <td>Performance Monitoring</td>
                <td>Clause 9.1</td>
                <td><span class="badge badge-info">Ongoing</span></td>
            </tr>
        </table>
    </div>

    {# Recommendations #}
    <div class="section">
        <h2>Audit Recommendations</h2>
        <table>
            <tr>
                <th>Area</th>
                <th>Recommendation</th>
            </tr>
            <tr>
                <td>Internal Audits</td>
                <td>Schedule at least one comprehensive ISMS audit annually covering all ISO 27001 clauses</td>
            </tr>
            <tr>
                <td>Management Reviews</td>
                <td>Conduct management reviews at least annually, documenting inputs, outputs, and actions</td>
            </tr>
            <tr>
                <td>Follow-up</td>
                <td>Track and close audit findings within agreed timeframes</td>
            </tr>
            <tr>
                <td>Documentation</td>
                <td>Maintain complete audit records including scope, criteria, findings, and conclusions</td>
            </tr>
        </table>
    </div>

    <div class="footer">
        Confidential - Audit Management Report | Little ISMS Helper
    </div>
</body>
</html>
