{% extends 'base.html.twig' %}

{% block title %}Interested Parties{% endblock %}

{% block body %}
<div class="container">
    <div class="page-header">
        <h1>Interested Parties Management</h1>
        <a href="{{ path('app_interested_party_new') }}" class="btn btn-primary">Add New Interested Party</a>
    </div>

    <p style="color: #666; margin-bottom: 2rem;">
        ISO 27001:2022 Chapter 4.2 - Understanding the needs and expectations of interested parties
    </p>

    {% if overdue_communications|length > 0 %}
    <div class="alert alert-warning">
        <h4>⚠️ Overdue Communications</h4>
        <ul>
            {% for party in overdue_communications %}
            <li>
                <a href="{{ path('app_interested_party_show', {id: party.id}) }}">{{ party.name }}</a>
                ({{ party.partyType }}) - Next communication: {{ party.nextCommunication|date('Y-m-d') }}
            </li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    {% if high_importance|length > 0 %}
    <div class="info-box">
        <h3>High Importance Parties</h3>
        <ul>
            {% for party in high_importance %}
            <li>
                <a href="{{ path('app_interested_party_show', {id: party.id}) }}">{{ party.name }}</a>
                ({{ party.partyType }}) - Engagement Score: {{ party.getEngagementScore() }}
            </li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    <div class="card">
        <div class="card-header">
            <h2>Interested Parties ({{ interested_parties|length }})</h2>
        </div>
        <div class="card-content">
            {% if interested_parties|length > 0 %}
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Type</th>
                        <th>Importance</th>
                        <th>Engagement Score</th>
                        <th>Last Communication</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for party in interested_parties %}
                    <tr>
                        <td><a href="{{ path('app_interested_party_show', {id: party.id}) }}">{{ party.name }}</a></td>
                        <td><span class="badge badge-info">{{ party.partyType }}</span></td>
                        <td><span class="badge badge-{{ party.importance }}">{{ party.importance|upper }}</span></td>
                        <td>{{ party.getEngagementScore() }}</td>
                        <td>{{ party.lastCommunication ? party.lastCommunication|date('Y-m-d') : 'Never' }}</td>
                        <td>
                            <a href="{{ path('app_interested_party_show', {id: party.id}) }}" class="btn btn-sm btn-secondary">View</a>
                            <a href="{{ path('app_interested_party_edit', {id: party.id}) }}" class="btn btn-sm btn-primary">Edit</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p>No interested parties found. <a href="{{ path('app_interested_party_new') }}">Add your first interested party</a>.</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
