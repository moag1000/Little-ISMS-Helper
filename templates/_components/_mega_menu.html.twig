{#
 # Two-Level Mega Menu Navigation
 # Modern, accessible navigation with primary categories and detailed subcategories
 # Note: data-controller="mega-menu" is on <body> in base.html.twig
 #}
{% set current_route = app.request.attributes.get('_route') %}

<div class="mega-menu" role="navigation" aria-label="{{ 'nav.main_navigation'|trans({}, 'nav') }}">
    {# Level 1: Primary Navigation Categories #}
    <div class="mega-menu-primary">
        <ul class="mega-menu-categories" role="menubar">
            {# Dashboard Category #}
            <li class="mega-menu-category" role="none">
                <button class="mega-menu-trigger {% if current_route starts with 'app_home' or current_route starts with 'app_dashboard' or current_route starts with 'app_analytics_' %}active{% endif %}"
                        data-mega-menu-target="trigger"
                        data-category="dashboard"
                        data-action="click->mega-menu#toggle"
                        role="menuitem"
                        aria-haspopup="true"
                        aria-expanded="false">
                    <i class="bi bi-speedometer2" aria-hidden="true"></i>
                    <span>{{ 'nav.mega.category.dashboard'|trans({}, 'nav') }}</span>
                    <i class="bi bi-chevron-right mega-menu-arrow" aria-hidden="true"></i>
                </button>
            </li>

            {# ISMS Core Category #}
            {% if is_module_active('core') or is_module_active('controls') %}
            <li class="mega-menu-category" role="none">
                <button class="mega-menu-trigger {% if current_route starts with 'app_context_' or current_route starts with 'app_interested_party_' or current_route starts with 'app_soa_' or current_route starts with 'app_objective_' %}active{% endif %}"
                        data-mega-menu-target="trigger"
                        data-category="isms-core"
                        data-action="click->mega-menu#toggle"
                        role="menuitem"
                        aria-haspopup="true"
                        aria-expanded="false">
                    <i class="bi bi-shield-check" aria-hidden="true"></i>
                    <span>{{ 'nav.mega.category.isms_core'|trans({}, 'nav') }}</span>
                    <i class="bi bi-chevron-right mega-menu-arrow" aria-hidden="true"></i>
                </button>
            </li>
            {% endif %}

            {# Assets & Risk Category #}
            {% if is_module_active('assets') or is_module_active('risks') %}
            <li class="mega-menu-category" role="none">
                <button class="mega-menu-trigger {% if current_route starts with 'app_asset_' or current_route starts with 'app_supplier_' or current_route starts with 'app_location_' or current_route starts with 'app_person_' or current_route starts with 'app_risk_' %}active{% endif %}"
                        data-mega-menu-target="trigger"
                        data-category="assets-risk"
                        data-action="click->mega-menu#toggle"
                        role="menuitem"
                        aria-haspopup="true"
                        aria-expanded="false">
                    <i class="bi bi-box-seam" aria-hidden="true"></i>
                    <span>{{ 'nav.mega.category.assets_risk'|trans({}, 'nav') }}</span>
                    <i class="bi bi-chevron-right mega-menu-arrow" aria-hidden="true"></i>
                </button>
            </li>
            {% endif %}

            {# BCM Category #}
            {% if is_module_active('bcm') %}
            <li class="mega-menu-category" role="none">
                <button class="mega-menu-trigger {% if current_route starts with 'app_business_process_' or current_route starts with 'app_bc_plan_' or current_route starts with 'app_bc_exercise_' or current_route starts with 'app_crisis_team_' %}active{% endif %}"
                        data-mega-menu-target="trigger"
                        data-category="bcm"
                        data-action="click->mega-menu#toggle"
                        role="menuitem"
                        aria-haspopup="true"
                        aria-expanded="false">
                    <i class="bi bi-shield-shaded" aria-hidden="true"></i>
                    <span>{{ 'nav.mega.category.bcm'|trans({}, 'nav') }}</span>
                    <i class="bi bi-chevron-right mega-menu-arrow" aria-hidden="true"></i>
                </button>
            </li>
            {% endif %}

            {# Privacy/GDPR Category #}
            <li class="mega-menu-category" role="none">
                <button class="mega-menu-trigger {% if current_route starts with 'app_processing_activity_' or current_route starts with 'app_dpia_' or current_route starts with 'app_data_breach_' %}active{% endif %}"
                        data-mega-menu-target="trigger"
                        data-category="privacy"
                        data-action="click->mega-menu#toggle"
                        role="menuitem"
                        aria-haspopup="true"
                        aria-expanded="false">
                    <i class="bi bi-shield-lock" aria-hidden="true"></i>
                    <span>{{ 'nav.mega.category.privacy'|trans({}, 'nav') }}</span>
                    <i class="bi bi-chevron-right mega-menu-arrow" aria-hidden="true"></i>
                </button>
            </li>

            {# Operations Category #}
            {% if is_module_active('core') or is_module_active('incidents') %}
            <li class="mega-menu-category" role="none">
                <button class="mega-menu-trigger {% if current_route starts with 'app_document_' or current_route starts with 'app_change_request_' or current_route starts with 'app_workflow_' or current_route starts with 'app_incident_' or current_route starts with 'app_vulnerability_' or current_route starts with 'app_patch_' %}active{% endif %}"
                        data-mega-menu-target="trigger"
                        data-category="operations"
                        data-action="click->mega-menu#toggle"
                        role="menuitem"
                        aria-haspopup="true"
                        aria-expanded="false">
                    <i class="bi bi-gear" aria-hidden="true"></i>
                    <span>{{ 'nav.mega.category.operations'|trans({}, 'nav') }}</span>
                    <i class="bi bi-chevron-right mega-menu-arrow" aria-hidden="true"></i>
                </button>
            </li>
            {% endif %}

            {# Compliance Category #}
            {% if is_module_active('audits') or is_module_active('compliance') %}
            <li class="mega-menu-category" role="none">
                <button class="mega-menu-trigger {% if current_route starts with 'app_audit_' or current_route starts with 'app_training_' or current_route starts with 'app_management_review_' or current_route starts with 'app_compliance_' or current_route starts with 'app_mapping_quality_' or current_route starts with 'app_nis2_' %}active{% endif %}"
                        data-mega-menu-target="trigger"
                        data-category="compliance"
                        data-action="click->mega-menu#toggle"
                        role="menuitem"
                        aria-haspopup="true"
                        aria-expanded="false">
                    <i class="bi bi-check-circle" aria-hidden="true"></i>
                    <span>{{ 'nav.mega.category.compliance'|trans({}, 'nav') }}</span>
                    <i class="bi bi-chevron-right mega-menu-arrow" aria-hidden="true"></i>
                </button>
            </li>
            {% endif %}

            {# Admin Category #}
            {% if is_granted('ROLE_ADMIN') %}
            <li class="mega-menu-category" role="none">
                <button class="mega-menu-trigger {% if current_route starts with 'admin_' or current_route starts with 'user_management_' or current_route starts with 'role_management_' or current_route starts with 'tenant_management_' %}active{% endif %}"
                        data-mega-menu-target="trigger"
                        data-category="admin"
                        data-action="click->mega-menu#toggle"
                        role="menuitem"
                        aria-haspopup="true"
                        aria-expanded="false">
                    <i class="bi bi-gear-fill" aria-hidden="true"></i>
                    <span>{{ 'nav.mega.category.admin'|trans({}, 'nav') }}</span>
                    <i class="bi bi-chevron-right mega-menu-arrow" aria-hidden="true"></i>
                </button>
            </li>
            {% endif %}
        </ul>
    </div>

</div>
