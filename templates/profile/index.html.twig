{% extends 'base.html.twig' %}

{% block title %}{{ 'profile.title'|trans({}, 'user') }}{% endblock %}

{% block body %}
<div class="container-fluid">
    <div class="row mb-4">
        <div class="col">
            <h1 class="mb-0">
                <i class="bi bi-person-circle" aria-hidden="true"></i>
                {{ 'profile.title'|trans({}, 'user') }}
            </h1>
        </div>
        <div class="col-auto">
            <a href="{{ path('app_profile_edit') }}" class="btn btn-primary">
                <i class="bi bi-pencil" aria-hidden="true"></i>
                {{ 'profile.action.edit'|trans({}, 'user') }}
            </a>
        </div>
    </div>

    <div class="row">
        <div class="col-md-4 mb-4">
            {# Profile Picture Card #}
            <div class="card">
                <div class="card-body text-center">
                    <h5 class="card-title">{{ 'profile.section.avatar'|trans({}, 'user') }}</h5>

                    {% if user.profilePicture %}
                        <img src="{{ asset(user.profilePicture) }}"
                             alt="{{ user.fullName }}"
                             class="rounded-circle mb-3"
                             style="width: 150px; height: 150px; object-fit: cover;">
                    {% else %}
                        <div class="bg-secondary text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-3"
                             style="width: 150px; height: 150px; font-size: 3rem;">
                            {{ user.firstName|first|upper }}{{ user.lastName|first|upper }}
                        </div>
                    {% endif %}

                    <h4 class="mb-0">{{ user.fullName }}</h4>
                    <p class="text-muted">{{ user.email }}</p>

                    {% if user.profilePicture %}
                        <form method="post" action="{{ path('app_profile_avatar_delete') }}" class="mt-3">
                            <input type="hidden" name="_token" value="{{ csrf_token('delete_avatar' ~ user.id) }}">
                            <button type="submit" class="btn btn-sm btn-outline-danger"
                                    onclick="return confirm('{{ 'profile.confirm.delete_avatar'|trans({}, 'user') }}')">
                                <i class="bi bi-trash" aria-hidden="true"></i>
                                {{ 'profile.action.delete_avatar'|trans({}, 'user') }}
                            </button>
                        </form>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="col-md-8">
            {# Basic Information Card #}
            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">{{ 'user.section.basic_info'|trans({}, 'user') }}</h5>
                </div>
                <div class="card-body">
                    <dl class="row mb-0">
                        <dt class="col-sm-4">{{ 'user.field.first_name'|trans({}, 'user') }}</dt>
                        <dd class="col-sm-8">{{ user.firstName }}</dd>

                        <dt class="col-sm-4">{{ 'user.field.last_name'|trans({}, 'user') }}</dt>
                        <dd class="col-sm-8">{{ user.lastName }}</dd>

                        <dt class="col-sm-4">{{ 'user.field.email'|trans({}, 'user') }}</dt>
                        <dd class="col-sm-8">{{ user.email }}</dd>

                        {% if user.department %}
                            <dt class="col-sm-4">{{ 'user.field.department'|trans({}, 'user') }}</dt>
                            <dd class="col-sm-8">{{ user.department }}</dd>
                        {% endif %}

                        {% if user.jobTitle %}
                            <dt class="col-sm-4">{{ 'user.field.job_title'|trans({}, 'user') }}</dt>
                            <dd class="col-sm-8">{{ user.jobTitle }}</dd>
                        {% endif %}

                        {% if user.phoneNumber %}
                            <dt class="col-sm-4">{{ 'user.field.phone_number'|trans({}, 'user') }}</dt>
                            <dd class="col-sm-8">{{ user.phoneNumber }}</dd>
                        {% endif %}
                    </dl>
                </div>
            </div>

            {# Account Information Card #}
            <div class="card mb-4">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0">{{ 'profile.section.account'|trans({}, 'user') }}</h5>
                </div>
                <div class="card-body">
                    <dl class="row mb-0">
                        <dt class="col-sm-4">{{ 'user.field.roles'|trans({}, 'user') }}</dt>
                        <dd class="col-sm-8">
                            {% for role in user.roles %}
                                <span class="badge bg-secondary me-1">{{ role }}</span>
                            {% endfor %}
                        </dd>

                        {% if user.tenant %}
                            <dt class="col-sm-4">{{ 'user.field.tenant'|trans({}, 'user') }}</dt>
                            <dd class="col-sm-8">{{ user.tenant.name }}</dd>
                        {% endif %}

                        <dt class="col-sm-4">{{ 'profile.field.language'|trans({}, 'user') }}</dt>
                        <dd class="col-sm-8">{{ user.language|default('de') }}</dd>

                        <dt class="col-sm-4">{{ 'profile.field.timezone'|trans({}, 'user') }}</dt>
                        <dd class="col-sm-8">{{ user.timezone|default('Europe/Berlin') }}</dd>

                        <dt class="col-sm-4">{{ 'user.field.created_at'|trans({}, 'user') }}</dt>
                        <dd class="col-sm-8">{{ user.createdAt|date('d.m.Y H:i') }}</dd>

                        {% if user.lastLoginAt %}
                            <dt class="col-sm-4">{{ 'user.field.last_login'|trans({}, 'user') }}</dt>
                            <dd class="col-sm-8">{{ user.lastLoginAt|date('d.m.Y H:i') }}</dd>
                        {% endif %}
                    </dl>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
