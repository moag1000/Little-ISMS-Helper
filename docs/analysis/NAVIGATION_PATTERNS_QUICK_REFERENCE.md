# Navigation Patterns - Quick Reference Guide

## File Locations for Key Patterns

### 1. Sidebar Submenu Pattern
**Source**: `/templates/base.html.twig` - Lines 205-249

**Key Elements**:
- Container: `<li class="has-submenu" data-controller="sidebar-dropdown">`
- Toggle link: `class="submenu-toggle"` with `data-action="click->sidebar-dropdown#toggle:prevent"`
- Submenu list: `<ul class="submenu" data-sidebar-dropdown-target="submenu">`
- Icons: Chevron down icon that rotates on toggle
- State persistence: `data-sidebar-dropdown-key-value="sidebar-compliance-expanded"`

**Key Features**:
- Dynamic framework list generated by `get_compliance_frameworks_quick()`
- Divider sections with labels (e.g., "Frameworks", "Tools")
- Visual indicators (icons, badges for mandatory frameworks)
- Current page highlighting with `active` class

**To Apply To**:
- BCM (group all 3 entities under one submenu)
- Potentially Audit/Asset (less critical)

---

### 2. Quick Access Bar Pattern
**Source**: `/templates/compliance/index.html.twig` - Lines 34-59

**Key Elements**:
- Container: `<div class="quick-access-bar">`
- Header: `<div class="quick-access-header">` with title and hint
- Items grid: `<div class="quick-access-items">`
- Item card: `<a href="" class="quick-access-item">`

**Key Features**:
- Mini progress bar showing completion percentage
- Color-coded status (green >= 75%, yellow >= 50%, red < 50%)
- Icons and codes for quick visual identification
- Responsive grid that wraps on mobile
- Hover effects with visual feedback

**To Apply To**:
- Risk (show high-risk items)
- BCM (show critical processes)
- Incident (show open/critical incidents)
- Audit (show upcoming audits)
- Asset (show critical assets)

---

### 3. Breadcrumb Component
**Source**: `/templates/_components/_breadcrumb.html.twig`

**Usage**:
```twig
{% include '_components/_breadcrumb.html.twig' with {
    breadcrumbs: [
        { label: 'Home', url: path('app_home') },
        { label: 'Module Name', url: path('app_module_index') },
        { label: 'Current Page' }  # Last item (no URL)
    ]
} %}
```

**Key Features**:
- Semantic `<nav aria-label="breadcrumb">`
- Home icon included automatically
- Last item marked as current page (no link)
- Proper Bootstrap breadcrumb styling
- Turbo-compatible links

**To Apply To**:
- Risk index (add breadcrumb)
- BCM index and all subpages
- Incident index
- Audit index
- Asset index

---

### 4. Tabs Interface
**Source**: `/templates/compliance/framework_dashboard.html.twig` - Lines around tab section

**Key Elements**:
- Container: `<div class="tabs" data-controller="toggle">`
- Tab nav: `<div class="tab-nav">`
- Tab buttons: `<button class="tab-button" data-tab="target_id">`
- Tab panels: `<div id="target_id" class="tab-panel">`

**Key Features**:
- Stimulus controller for tab switching
- Visual indicator for active tab
- Content panels hidden/shown with CSS classes
- Can link to specific tabs via URL hash

**To Apply To**:
- BCM (tabs: Process | Plans | Exercises)
- Risk (tabs: All | Critical | High | Medium | Low)
- Incident (tabs: All | Critical | High | Open | NIS2)
- Audit (tabs: All | Planned | In Progress | Completed)
- Asset (tabs: All | Critical | High-Value | By Type)

---

### 5. KPI Cards (Make Clickable)
**Source**: `/templates/audit/index.html.twig` - Lines 18-29

**Current Pattern**:
```html
<div class="stats-grid mb-4">
    <div class="stat-card">
        <div class="stat-icon"><i class="bi bi-calendar-event"></i></div>
        <div class="stat-value">{{ upcoming|length }}</div>
        <div class="stat-label">{{ 'audit_management.planned_audits'|trans }}</div>
    </div>
</div>
```

**Enhancement** (wrap in link or add JavaScript):
```html
<a href="{{ path('app_audit_index', {status: 'planned'}) }}" 
   class="stat-card stat-card-clickable">
    <!-- content -->
</a>
```

**To Apply To**:
- Incident (make severity cards clickable for filtering)
- Audit (make status cards clickable)
- Risk (make level cards clickable)

---

### 6. Workflow Steps Checklist
**Source**: `/templates/compliance/framework_dashboard.html.twig` - Lines 68-136

**Key Elements**:
- Container: `<div class="workflow-steps-card">`
- Step item: `<div class="workflow-step">`
- Step icon: Shows progress (number/emoji/checkmark)
- Step content: Title, description, optional action link
- CSS classes: `completed`, `active` for state

**Key Features**:
- Visual progress indication
- Tooltips with detailed information
- Action links to next steps
- Auto-update based on data

**To Apply To**:
- Risk (workflow: identify → assess → treat → monitor)
- BCM (workflow: processes → create plans → test plans)
- Incident (workflow: report → investigate → contain → resolve)

---

## Template Size Reference

| Module | Current Size | Target Size | Growth |
|--------|-------------|------------|--------|
| Compliance | 569 lines | 569+ | - (reference) |
| Risk | 20 lines | 200+ | 10x |
| BCM | 234 lines | 300+ | 1.3x |
| Incident | 357 lines | 400+ | 1.1x |
| Audit | 199 lines | 250+ | 1.3x |
| Asset | 286 lines | 350+ | 1.2x |

---

## Controller Enhancements Needed

### For Quick Access Bars - Add to Controller's index() method:

**Risk Module Example**:
```php
public function index(Request $request): Response
{
    // ... existing code ...
    
    // For quick access bar
    $highRisks = array_slice($risks, 0, 6);  // Top 6 high-risk items
    
    return $this->render('risk/index.html.twig', [
        'risks' => $risks,
        'quick_access' => $highRisks,  // Pass to template
        // ... other vars ...
    ]);
}
```

### For Tab Filtering - Add route parameters:

```php
#[Route('/', name: 'app_risk_index')]
public function index(Request $request): Response
{
    $level = $request->query->get('level');  // Can filter by level
    $view = $request->query->get('view', 'all');  // Tab selection
    
    // Filter logic...
    
    return $this->render('risk/index.html.twig', [
        'current_view' => $view,
        // ...
    ]);
}
```

---

## CSS Classes to Understand

### Sidebar/Navigation
- `.has-submenu` - Container for submenu items
- `.submenu-toggle` - Toggle link that opens/closes submenu
- `.submenu` - Hidden submenu container
- `.submenu-divider` - Section divider in submenu
- `.submenu-icon` - Chevron icon that rotates

### Quick Access
- `.quick-access-bar` - Container for quick access items
- `.quick-access-item` - Individual card
- `.quick-access-item.mandatory` - Highlight for mandatory items
- `.quick-access-progress` - Progress bar mini version
- `.progress-bar-mini`, `.progress-fill-mini` - Small progress indicators

### Tabs
- `.tabs` - Tab container
- `.tab-nav` - Tab buttons container
- `.tab-button` - Individual tab button
- `.tab-button.active` - Current active tab
- `.tab-panel` - Tab content panel
- `.tab-panel.active` - Visible content

### KPI/Stats
- `.stats-grid` - Grid container for stat cards
- `.stat-card` - Individual stat card
- `.stat-icon` - Icon container
- `.stat-value` - Large number display
- `.stat-label` - Card label text

---

## Stimulus Controllers Used

### sidebar-dropdown
**File**: Look in `/assets/controllers/` for `sidebar-dropdown_controller.js`

**Data Attributes**:
- `data-controller="sidebar-dropdown"` - Activates controller
- `data-sidebar-dropdown-key-value="unique-key"` - Persistence key
- `data-sidebar-dropdown-target="toggle"` - Toggle button
- `data-sidebar-dropdown-target="submenu"` - Submenu container
- `data-sidebar-dropdown-target="icon"` - Chevron icon

**Actions**:
- `click->sidebar-dropdown#toggle:prevent` - Toggle submenu on click

### toggle
**File**: Look in `/assets/controllers/` for `toggle_controller.js`

**Data Attributes**:
- `data-controller="toggle"` - Activates controller
- `data-tab="target-id"` - Links button to panel
- `data-toggle-target="button"` - Tab button
- `data-toggle-target="panel"` - Content panel

---

## Translation Keys to Use

### Compliance
- `'nav.compliance'` - Navigation label
- `'nav.frameworks'` - Frameworks section
- `'nav.tools'` - Tools section
- `'compliance.quick_access'` - Quick access header
- `'compliance.switch_framework'` - Framework switcher label

### Risk (Need to add these)
- `'nav.risks'`
- `'risk.quick_access'`
- `'risk.level.critical'`, `.high`, `.medium`, `.low`

### Similar for other modules...

---

## Browser DevTools Tips

1. **To inspect submenu state**:
   - Check `data-sidebar-dropdown-key-value` in localStorage
   - Look for `aria-expanded="true/false"` on toggle

2. **To test tabs**:
   - Check URL hash changes when switching tabs
   - Verify `tab-button.active` class toggles

3. **To verify KPI click behavior**:
   - Check Network tab for GET request with filter params
   - Look for URL query string changes

---

## Next Steps

1. **Week 1**: Risk Module Implementation
   - [ ] Expand index.html.twig to 200+ lines
   - [ ] Add KPI dashboard
   - [ ] Add breadcrumb component
   - [ ] Add quick-access bar
   - [ ] Add risk-level tabs

2. **Week 2**: BCM Module Implementation
   - [ ] Add sidebar submenu
   - [ ] Update all BCM templates with breadcrumbs
   - [ ] Create unified view with tabs
   - [ ] Add quick-access bar
   - [ ] Test navigation flow

3. **Week 3-4**: Other modules

---

## Testing Checklist

For each module:
- [ ] Sidebar navigation works on desktop and mobile
- [ ] Quick-access items are clickable and navigate correctly
- [ ] Breadcrumbs display correct hierarchy
- [ ] Tabs switch views without page reload
- [ ] KPI cards are clickable (if implemented)
- [ ] All links use proper Turbo data attributes
- [ ] Keyboard navigation works for all interactive elements
- [ ] ARIA attributes are present and correct
- [ ] Mobile responsive layout works
- [ ] Links maintain context (filters, view state)
- [ ] Accessibility testing with screen reader
